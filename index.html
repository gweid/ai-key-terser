<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
  <title>API Key æµ‹æ´»å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* æš—è‰²ä¸»é¢˜æ ·å¼ */
    .dark-theme {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }

    .dark-theme .container {
      background: linear-gradient(135deg, #232741 0%, #1e1e2e 100%);
      color: #e8eaed;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .dark-theme .header {
      background: linear-gradient(135deg, #232741 0%, #1e1e2e 100%);
    }

    .dark-theme .input-section {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .input-section:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      box-shadow: 0 4px 20px rgba(76, 99, 210, 0.15);
    }

    .dark-theme .form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #e8eaed;
      border-color: #3c4269;
    }

    .dark-theme .form-control:focus {
      border-color: #4c63d2;
      box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
    }

    .dark-theme .form-control:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #252849 0%, #2a2d47 100%);
    }

    .dark-theme select.form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #e8eaed;
    }

    .dark-theme select.form-control option {
      background: #232741;
      color: #e8eaed;
    }

    .dark-theme input.form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #e8eaed;
    }

    .dark-theme textarea.form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #e8eaed;
    }

    .dark-theme .stat-card {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .stat-card:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(76, 99, 210, 0.2);
    }

    .dark-theme .key-list {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .key-list:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      box-shadow: 0 2px 12px rgba(76, 99, 210, 0.15);
    }

    .dark-theme .empty-state {
      color: #b0b3c1;
    }

    .dark-theme .empty-icon {
      opacity: 0.5;
    }

    .dark-theme .empty-text {
      opacity: 0.7;
    }

    .dark-theme .key-item {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .key-item:hover {
      background: linear-gradient(135deg, #2a2d47 0%, #1e1e2e 100%);
      border-color: #4c63d2;
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(76, 99, 210, 0.15);
    }

    .dark-theme .tab {
      color: #b0b3c1;
    }

    .dark-theme .tab.active {
      color: #4c63d2;
    }

    .dark-theme .alert {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
      color: #e8eaed;
    }

    .dark-theme .alert:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      box-shadow: 0 2px 12px rgba(76, 99, 210, 0.2);
    }

    .dark-theme .btn-secondary {
      background: linear-gradient(135deg, #3c4269 0%, #2a2d47 100%);
    }

    .dark-theme .btn-secondary:hover {
      background: linear-gradient(135deg, #4a5079 0%, #3c4269 100%);
    }

    .dark-theme .form-help {
      color: #b0b3c1;
    }

    .dark-theme .stat-label {
      color: #b0b3c1;
    }

    .dark-theme .input-group label {
      color: #e8eaed;
    }

    .dark-theme .detected-models {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .detected-models:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      box-shadow: 0 2px 12px rgba(76, 99, 210, 0.2);
    }

    .dark-theme .detected-models-header {
      border-bottom-color: #3c4269;
    }

    .dark-theme .detected-models-header:hover {
      background: rgba(76, 99, 210, 0.1);
    }

    .dark-theme .detected-models-header h4 {
      color: #4c63d2;
    }

    .dark-theme .collapse-icon {
      color: #4c63d2;
    }

    .dark-theme .model-tag {
      background: #4c63d2;
    }

    .dark-theme .model-tag:hover {
      background: #3c52d2;
    }

    .dark-theme .model-toggle-btn {
      background: #3c4269;
    }

    .dark-theme .model-toggle-btn:hover {
      background: #4a5079;
    }

    .dark-theme .model-toggle-btn.active {
      background: #4c63d2;
    }

    .dark-theme .concurrency-container {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .concurrency-container:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
    }

    .dark-theme .concurrency-input-section .form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #4c63d2;
      border-color: #3c4269;
    }

    .dark-theme .concurrency-input-section .form-control:focus {
      border-color: #4c63d2;
      box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
    }

    .dark-theme .slider {
      background: #3c4269;
    }

    .dark-theme .slider::-webkit-slider-thumb {
      background: #4c63d2;
    }

    .dark-theme .slider::-webkit-slider-thumb:hover {
      background: #3c52d2;
    }

    .dark-theme .slider::-moz-range-thumb {
      background: #4c63d2;
    }

    .dark-theme .slider-value {
      color: #4c63d2;
      background: #232741;
      border-color: #3c4269;
    }

    .dark-theme .preset-btn {
      border-color: #4c63d2;
      color: #4c63d2;
      background: #232741;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .dark-theme .preset-btn:hover {
      background: #4c63d2;
      color: white;
      box-shadow: 0 4px 12px rgba(76, 99, 210, 0.3);
    }

    .dark-theme .preset-btn.active {
      background: #4c63d2;
      color: white;
      box-shadow: 0 4px 12px rgba(76, 99, 210, 0.4);
    }

    /* æ·±è‰²ä¸»é¢˜é‡è¯•ç›¸å…³æ ·å¼ */
    .dark-theme .retry-container {
      background: linear-gradient(135deg, #3d3314 0%, #2d2a1a 100%);
      border-color: #5d4e23;
    }

    .dark-theme .retry-container:hover {
      border-color: #d68910;
      background: linear-gradient(135deg, #4d4024 0%, #3d3314 100%);
    }

    .dark-theme .retry-input-section .form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #d68910;
      border-color: #5d4e23;
    }

    .dark-theme .retry-input-section .form-control:focus {
      border-color: #d68910;
      box-shadow: 0 0 0 3px rgba(214, 137, 16, 0.1);
    }

    .dark-theme .retry-slider {
      background: #5d4e23;
    }

    .dark-theme .retry-slider::-webkit-slider-thumb {
      background: #d68910;
    }

    .dark-theme .retry-slider::-webkit-slider-thumb:hover {
      background: #b7791f;
    }

    .dark-theme .retry-slider::-moz-range-thumb {
      background: #d68910;
    }

    .dark-theme .retry-slider-value {
      color: #d68910;
      background: #232741;
      border-color: #5d4e23;
    }

    .dark-theme .retry-preset-btn {
      border-color: #d68910;
      color: #d68910;
      background: #232741;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .dark-theme .retry-preset-btn:hover {
      background: #d68910;
      color: white;
      box-shadow: 0 4px 12px rgba(214, 137, 16, 0.3);
    }

    .dark-theme .retry-preset-btn.active {
      background: #d68910;
      color: white;
      box-shadow: 0 4px 12px rgba(214, 137, 16, 0.4);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 10px;
      line-height: 1.5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 20px;
      text-align: center;
    }

    .header h1 {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      margin-bottom: 8px;
      font-weight: 700;
      word-break: break-word;
    }

    .header p {
      font-size: clamp(0.9rem, 2.5vw, 1.1rem);
      opacity: 0.9;
      line-height: 1.4;
    }

    .main-content {
      padding: 20px;
    }

    .input-section {
      background: #f8f9fa;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }

    .input-section:hover {
      border-color: #667eea;
      background: #f0f4ff;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.1);
    }

    .input-group {
      margin-bottom: 16px;
    }

    .input-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #495057;
      font-size: clamp(0.9rem, 2vw, 1rem);
    }

    .form-control {
      width: 100%;
      padding: 12px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: clamp(14px, 2.5vw, 16px);
      transition: all 0.3s ease;
      background: white;
    }

    .form-control:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .form-control:hover {
      border-color: #667eea;
      background: #fafbff;
    }

    .form-control.textarea {
      resize: vertical;
      min-height: 100px;
      font-family: 'Courier New', monospace;
      font-size: clamp(12px, 2vw, 14px);
    }

    .form-help {
      color: #6c757d;
      font-size: clamp(10px, 1.8vw, 12px);
      margin-top: 4px;
      display: block;
      line-height: 1.3;
    }

    .model-input-group {
      display: flex;
      gap: 8px;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    .model-input-group .form-control {
      flex: 1;
      min-width: 0;
    }

    .model-toggle-btn {
      padding: 12px 12px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: clamp(12px, 2vw, 14px);
      white-space: nowrap;
      transition: background 0.3s ease;
      flex-shrink: 0;
    }

    .model-toggle-btn:hover {
      background: #5a6268;
    }

    .model-toggle-btn.active {
      background: #667eea;
    }

    .detected-models {
      background: #e3f2fd;
      border: 1px solid #bbdefb;
      border-radius: 8px;
      margin-top: 10px;
      display: none;
      transition: all 0.3s ease;
    }

    .detected-models:hover {
      border-color: #2196f3;
      background: #e1f5fe;
      box-shadow: 0 2px 12px rgba(33, 150, 243, 0.15);
    }

    .detected-models-header {
      padding: 12px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #bbdefb;
      transition: background 0.3s ease;
    }

    .detected-models-header:hover {
      background: rgba(33, 150, 243, 0.1);
    }

    .detected-models-header h4 {
      margin: 0;
      color: #1976d2;
      font-size: clamp(12px, 2vw, 14px);
    }

    .collapse-icon {
      color: #1976d2;
      font-size: 14px;
      transition: transform 0.3s ease;
    }

    .collapse-icon.collapsed {
      transform: rotate(-90deg);
    }

    .model-list-container {
      padding: 12px;
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }

    .model-list-container.expanded {
      display: block;
    }

    .model-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .model-tag {
      background: #2196f3;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: clamp(10px, 1.8vw, 12px);
      cursor: pointer;
      transition: background 0.3s ease;
      word-break: break-all;
    }

    .model-tag:hover {
      background: #1976d2;
    }

    /* å¹¶å‘è®¾ç½®æ ·å¼ - ç§»åŠ¨ç«¯ä¼˜åŒ– */
    .concurrency-container {
      display: flex;
      flex-direction: row;
      gap: 16px;
      align-items: center;
      margin-top: 12px;
      padding: 16px;
      background: #f1f3f5;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .concurrency-container:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .concurrency-input-section {
      flex-shrink: 0;
      min-width: 80px;
    }

    .concurrency-input-section .form-control {
      width: 80px;
      text-align: center;
      font-weight: 600;
      color: #667eea;
      background: white;
      border: 2px solid #dee2e6;
    }

    .concurrency-input-section .form-control:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .slider-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .slider {
      flex: 1;
      -webkit-appearance: none;
      height: 6px;
      border-radius: 3px;
      background: #dee2e6;
      outline: none;
      transition: background 0.3s ease;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #667eea;
      cursor: pointer;
      transition: background 0.3s ease;
      box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
    }

    .slider::-webkit-slider-thumb:hover {
      background: #5a67d8;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #667eea;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
    }

    .slider-value {
      min-width: 30px;
      text-align: center;
      font-weight: 700;
      color: #667eea;
      font-size: clamp(14px, 2.5vw, 18px);
      background: white;
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #dee2e6;
      flex-shrink: 0;
    }

    .preset-buttons {
      display: flex;
      gap: 6px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .preset-btn {
      padding: 8px 12px;
      border: 1px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 8px;
      cursor: pointer;
      font-size: clamp(11px, 2vw, 13px);
      font-weight: 500;
      transition: all 0.3s ease;
      min-width: 50px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      flex: 1;
      max-width: 80px;
    }

    .preset-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .preset-btn.active {
      background: #667eea;
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    /* é‡è¯•è®¾ç½®æ ·å¼ */
    .retry-container {
      display: flex;
      flex-direction: row;
      gap: 16px;
      align-items: center;
      margin-top: 12px;
      padding: 16px;
      background: #fff3cd;
      border: 2px solid #ffeaa7;
      border-radius: 12px;
      transition: all 0.3s ease;
    }

    .retry-container:hover {
      border-color: #f39c12;
      background: #fef9e7;
    }

    .retry-input-section {
      flex-shrink: 0;
      min-width: 80px;
    }

    .retry-input-section .form-control {
      width: 80px;
      text-align: center;
      font-weight: 600;
      color: #f39c12;
      background: white;
      border: 2px solid #ffeaa7;
    }

    .retry-input-section .form-control:focus {
      border-color: #f39c12;
      box-shadow: 0 0 0 3px rgba(243, 156, 18, 0.1);
    }

    .retry-slider-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .retry-slider-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .retry-slider {
      flex: 1;
      -webkit-appearance: none;
      height: 6px;
      border-radius: 3px;
      background: #ffeaa7;
      outline: none;
      transition: background 0.3s ease;
    }

    .retry-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #f39c12;
      cursor: pointer;
      transition: background 0.3s ease;
      box-shadow: 0 2px 6px rgba(243, 156, 18, 0.3);
    }

    .retry-slider::-webkit-slider-thumb:hover {
      background: #e67e22;
      box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
    }

    .retry-slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #f39c12;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(243, 156, 18, 0.3);
    }

    .retry-slider-value {
      min-width: 30px;
      text-align: center;
      font-weight: 700;
      color: #f39c12;
      font-size: clamp(14px, 2.5vw, 18px);
      background: white;
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #ffeaa7;
      flex-shrink: 0;
    }

    .retry-preset-buttons {
      display: flex;
      gap: 6px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .retry-preset-btn {
      padding: 8px 12px;
      border: 1px solid #f39c12;
      background: white;
      color: #f39c12;
      border-radius: 8px;
      cursor: pointer;
      font-size: clamp(11px, 2vw, 13px);
      font-weight: 500;
      transition: all 0.3s ease;
      min-width: 50px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      flex: 1;
      max-width: 80px;
    }

    .retry-preset-btn:hover {
      background: #f39c12;
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);
    }

    .retry-preset-btn.active {
      background: #f39c12;
      color: white;
      box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4);
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn {
      flex: 1;
      min-width: 120px;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: clamp(14px, 2.5vw, 16px);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .btn-detect {
      background: #28a745;
      color: white;
    }

    .btn-detect:hover {
      background: #218838;
    }

    .results-section {
      margin-top: 20px;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 16px 12px;
      border-radius: 12px;
      text-align: center;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      border-color: #667eea;
      background: #f0f4ff;
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.15);
    }

    .stat-number {
      font-size: clamp(1.5rem, 4vw, 2rem);
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      color: #6c757d;
      font-size: clamp(0.8rem, 2vw, 0.9rem);
    }

    .valid {
      color: #28a745;
    }

    .invalid {
      color: #dc3545;
    }

    .rate-limited {
      color: #ffc107;
    }

    .testing {
      color: #6f42c1;
    }

    .retrying {
      color: #fd7e14;
    }

    .total {
      color: #6f42c1;
    }

    .results-tabs {
      display: flex;
      margin-bottom: 16px;
      border-bottom: 2px solid #e9ecef;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .tab {
      padding: 10px 16px;
      border: none;
      background: none;
      cursor: pointer;
      font-size: clamp(12px, 2.2vw, 16px);
      font-weight: 600;
      color: #6c757d;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .key-list {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 16px;
      max-height: 350px;
      overflow-y: auto;
      transition: all 0.3s ease;
      -webkit-overflow-scrolling: touch;
      min-height: 120px;
      display: flex;
      flex-direction: column;
    }

    .key-list:hover {
      border-color: #667eea;
      background: #f0f4ff;
      box-shadow: 0 2px 12px rgba(102, 126, 234, 0.1);
    }

    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      min-height: 80px;
      color: #6c757d;
      text-align: center;
      padding: 20px;
    }

    .empty-icon {
      font-size: 2rem;
      margin-bottom: 8px;
      opacity: 0.6;
    }

    .empty-text {
      font-size: clamp(14px, 2.5vw, 16px);
      font-weight: 500;
      opacity: 0.8;
    }

    .key-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 12px;
      margin-bottom: 8px;
      background: white;
      border-radius: 8px;
      border: 1px solid #dee2e6;
      transition: all 0.3s ease;
      flex-wrap: wrap;
      gap: 8px;
    }

    .key-item:hover {
      border-color: #667eea;
      background: #fafbff;
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
    }

    .key-text {
      font-family: 'Courier New', monospace;
      font-size: clamp(11px, 2vw, 14px);
      color: #495057;
      flex: 1;
      margin-right: 8px;
      word-break: break-all;
      line-height: 1.4;
      min-width: 0;
    }

    .key-status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: clamp(10px, 1.8vw, 12px);
      font-weight: 600;
      text-transform: uppercase;
      flex-shrink: 0;
    }

    .status-valid {
      background: #d4edda;
      color: #155724;
    }

    .status-invalid {
      background: #f8d7da;
      color: #721c24;
    }

    .status-rate-limited {
      background: #fff3cd;
      color: #856404;
    }

    .status-testing {
      background: #e2e3e5;
      color: #6c757d;
    }

    .status-retrying {
      background: #ffeaa7;
      color: #d68910;
      animation: pulse 1.5s ease-in-out infinite alternate;
    }

    @keyframes pulse {
      from {
        opacity: 0.6;
      }

      to {
        opacity: 1;
      }
    }

    .copy-btn {
      padding: 10px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: clamp(12px, 2vw, 14px);
      margin-top: 12px;
      width: 100%;
      transition: background 0.3s ease;
    }

    .copy-btn:hover {
      background: #0056b3;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin: 16px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%;
      transition: width 0.3s ease;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .hidden {
      display: none;
    }

    .alert {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      padding: 12px;
      border-radius: 8px;
      margin-top: 12px;
      color: #0c5460;
      transition: all 0.3s ease;
      font-size: clamp(12px, 2vw, 14px);
      line-height: 1.4;
    }

    .alert:hover {
      border-color: #17a2b8;
      background: #c3e6ea;
      box-shadow: 0 2px 12px rgba(23, 162, 184, 0.15);
    }

    /* ä¸»é¢˜åˆ‡æ¢æŒ‰é’® */
    .theme-controls {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 8px;
      z-index: 1000;
    }

    .control-btn {
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .control-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    /* ç§»åŠ¨ç«¯ç‰¹æ®Šä¼˜åŒ– */
    @media (max-width: 768px) {
      body {
        padding: 5px;
      }

      .container {
        border-radius: 15px;
        margin: 0;
      }

      .header {
        padding: 16px;
      }

      .main-content {
        padding: 16px;
      }

      .input-section {
        padding: 16px;
        margin-bottom: 16px;
      }

      .model-input-group {
        flex-direction: column;
        align-items: stretch;
      }

      .model-toggle-btn {
        width: 100%;
        margin-top: 8px;
      }

      .concurrency-container,
      .retry-container {
        flex-direction: column;
        gap: 12px;
        padding: 12px;
        align-items: stretch;
      }

      .concurrency-input-section,
      .retry-input-section {
        align-self: center;
        min-width: auto;
      }

      .concurrency-input-section .form-control,
      .retry-input-section .form-control {
        width: 100px;
        margin: 0 auto;
      }

      .slider-section,
      .retry-slider-section {
        width: 100%;
      }

      .preset-buttons,
      .retry-preset-buttons {
        gap: 4px;
        margin-top: 8px;
      }

      .preset-btn,
      .retry-preset-btn {
        min-width: 60px;
        max-width: none;
        flex: 1;
      }

      .button-group {
        flex-direction: column;
        gap: 12px;
      }

      .btn {
        min-width: auto;
        width: 100%;
      }

      .stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }

      .stat-card {
        padding: 12px 8px;
      }

      .results-tabs {
        gap: 4px;
      }

      .tab {
        padding: 8px 12px;
        font-size: 12px;
      }

      .key-list {
        padding: 12px;
        max-height: 300px;
      }

      .key-item {
        padding: 10px;
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }

      .key-text {
        margin-right: 0;
        width: 100%;
      }

      .key-status {
        align-self: flex-end;
      }

      .theme-controls {
        top: 8px;
        right: 8px;
        gap: 6px;
      }

      .control-btn {
        width: 32px;
        height: 32px;
        font-size: 14px;
      }

      .alert {
        padding: 10px;
        font-size: 12px;
      }
    }

    /* æ·±è‰²ä¸»é¢˜ */
    .dark-theme {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }

    .dark-theme .container {
      background: linear-gradient(135deg, #232741 0%, #1e1e2e 100%);
      color: #e8eaed;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .dark-theme .header {
      background: linear-gradient(135deg, #232741 0%, #1e1e2e 100%);
    }

    .dark-theme .input-section {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .input-section:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      box-shadow: 0 4px 20px rgba(76, 99, 210, 0.15);
    }

    .dark-theme .form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #e8eaed;
      border-color: #3c4269;
    }

    .dark-theme .form-control:focus {
      border-color: #4c63d2;
      box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
    }

    .dark-theme .form-control:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #252849 0%, #2a2d47 100%);
    }

    .dark-theme select.form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #e8eaed;
    }

    .dark-theme select.form-control option {
      background: #232741;
      color: #e8eaed;
    }

    .dark-theme input.form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #e8eaed;
    }

    .dark-theme textarea.form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #e8eaed;
    }

    .dark-theme .form-help {
      color: #b0b3c1;
    }

    .dark-theme .stat-label {
      color: #b0b3c1;
    }

    .dark-theme .input-group label {
      color: #e8eaed;
    }

    .dark-theme .stat-card {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .stat-card:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(76, 99, 210, 0.2);
    }

    .dark-theme .key-list {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .key-list:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      box-shadow: 0 2px 12px rgba(76, 99, 210, 0.15);
    }

    .dark-theme .empty-state {
      color: #b0b3c1;
    }

    .dark-theme .empty-icon {
      opacity: 0.5;
    }

    .dark-theme .empty-text {
      opacity: 0.7;
    }

    .dark-theme .key-item {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .key-item:hover {
      background: linear-gradient(135deg, #2a2d47 0%, #1e1e2e 100%);
      border-color: #4c63d2;
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(76, 99, 210, 0.15);
    }

    .dark-theme .tab {
      color: #b0b3c1;
    }

    .dark-theme .tab.active {
      color: #4c63d2;
    }

    .dark-theme .results-tabs {
      border-bottom-color: #3c4269;
    }

    .dark-theme .alert {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
      color: #e8eaed;
    }

    .dark-theme .alert:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      box-shadow: 0 2px 12px rgba(76, 99, 210, 0.2);
    }

    .dark-theme .btn-secondary {
      background: linear-gradient(135deg, #3c4269 0%, #2a2d47 100%);
    }

    .dark-theme .btn-secondary:hover {
      background: linear-gradient(135deg, #4a5079 0%, #3c4269 100%);
    }

    .dark-theme .detected-models {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .detected-models:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
      box-shadow: 0 2px 12px rgba(76, 99, 210, 0.2);
    }

    .dark-theme .detected-models-header {
      border-bottom-color: #3c4269;
    }

    .dark-theme .detected-models-header:hover {
      background: rgba(76, 99, 210, 0.1);
    }

    .dark-theme .detected-models-header h4 {
      color: #4c63d2;
    }

    .dark-theme .collapse-icon {
      color: #4c63d2;
    }

    .dark-theme .model-tag {
      background: #4c63d2;
    }

    .dark-theme .model-tag:hover {
      background: #3c52d2;
    }

    .dark-theme .model-toggle-btn {
      background: #3c4269;
    }

    .dark-theme .model-toggle-btn:hover {
      background: #4a5079;
    }

    .dark-theme .model-toggle-btn.active {
      background: #4c63d2;
    }

    .dark-theme .concurrency-container {
      background: linear-gradient(135deg, #2a2d47 0%, #232741 100%);
      border-color: #3c4269;
    }

    .dark-theme .concurrency-container:hover {
      border-color: #4c63d2;
      background: linear-gradient(135deg, #323556 0%, #2a2d47 100%);
    }

    .dark-theme .concurrency-input-section .form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #4c63d2;
      border-color: #3c4269;
    }

    .dark-theme .concurrency-input-section .form-control:focus {
      border-color: #4c63d2;
      box-shadow: 0 0 0 3px rgba(76, 99, 210, 0.1);
    }

    .dark-theme .slider {
      background: #3c4269;
    }

    .dark-theme .slider::-webkit-slider-thumb {
      background: #4c63d2;
    }

    .dark-theme .slider::-webkit-slider-thumb:hover {
      background: #3c52d2;
    }

    .dark-theme .slider::-moz-range-thumb {
      background: #4c63d2;
    }

    .dark-theme .slider-value {
      color: #4c63d2;
      background: #232741;
      border-color: #3c4269;
    }

    .dark-theme .preset-btn {
      border-color: #4c63d2;
      color: #4c63d2;
      background: #232741;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .dark-theme .preset-btn:hover {
      background: #4c63d2;
      color: white;
      box-shadow: 0 4px 12px rgba(76, 99, 210, 0.3);
    }

    .dark-theme .preset-btn.active {
      background: #4c63d2;
      color: white;
      box-shadow: 0 4px 12px rgba(76, 99, 210, 0.4);
    }

    /* æ·±è‰²ä¸»é¢˜é‡è¯•ç›¸å…³æ ·å¼ */
    .dark-theme .retry-container {
      background: linear-gradient(135deg, #3d3314 0%, #2d2a1a 100%);
      border-color: #5d4e23;
    }

    .dark-theme .retry-container:hover {
      border-color: #d68910;
      background: linear-gradient(135deg, #4d4024 0%, #3d3314 100%);
    }

    .dark-theme .retry-input-section .form-control {
      background: linear-gradient(135deg, #1e1e2e 0%, #232741 100%);
      color: #d68910;
      border-color: #5d4e23;
    }

    .dark-theme .retry-input-section .form-control:focus {
      border-color: #d68910;
      box-shadow: 0 0 0 3px rgba(214, 137, 16, 0.1);
    }

    .dark-theme .retry-slider {
      background: #5d4e23;
    }

    .dark-theme .retry-slider::-webkit-slider-thumb {
      background: #d68910;
    }

    .dark-theme .retry-slider::-webkit-slider-thumb:hover {
      background: #b7791f;
    }

    .dark-theme .retry-slider::-moz-range-thumb {
      background: #d68910;
    }

    .dark-theme .retry-slider-value {
      color: #d68910;
      background: #232741;
      border-color: #5d4e23;
    }

    .dark-theme .retry-preset-btn {
      border-color: #d68910;
      color: #d68910;
      background: #232741;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .dark-theme .retry-preset-btn:hover {
      background: #d68910;
      color: white;
      box-shadow: 0 4px 12px rgba(214, 137, 16, 0.3);
    }

    .dark-theme .retry-preset-btn.active {
      background: #d68910;
      color: white;
      box-shadow: 0 4px 12px rgba(214, 137, 16, 0.4);
    }

    /* æµ…è‰²ä¸»é¢˜æ»šåŠ¨æ¡æ ·å¼ */
    .model-list-container::-webkit-scrollbar,
    .results-tabs::-webkit-scrollbar,
    .key-list::-webkit-scrollbar,
    #apiKeys::-webkit-scrollbar {
      width: 8px;
    }

    .model-list-container::-webkit-scrollbar-track,
    .results-tabs::-webkit-scrollbar-track,
    .key-list::-webkit-scrollbar-track,
    #apiKeys::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    .model-list-container::-webkit-scrollbar-thumb,
    .results-tabs::-webkit-scrollbar-thumb,
    .key-list::-webkit-scrollbar-thumb,
    #apiKeys::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    .model-list-container::-webkit-scrollbar-thumb:hover,
    .results-tabs::-webkit-scrollbar-thumb:hover,
    .key-list::-webkit-scrollbar-thumb:hover,
    #apiKeys::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }

    /* æ·±è‰²ä¸»é¢˜æ»šåŠ¨æ¡æ ·å¼ */
    .dark-theme .model-list-container::-webkit-scrollbar,
    .dark-theme .results-tabs::-webkit-scrollbar,
    .dark-theme .key-list::-webkit-scrollbar,
    .dark-theme #apiKeys::-webkit-scrollbar {
      width: 8px;
    }

    .dark-theme .model-list-container::-webkit-scrollbar-track,
    .dark-theme .results-tabs::-webkit-scrollbar-track,
    .dark-theme .key-list::-webkit-scrollbar-track,
    .dark-theme #apiKeys::-webkit-scrollbar-track {
      background: #1e1e2e;
      border-radius: 4px;
    }

    .dark-theme .model-list-container::-webkit-scrollbar-thumb,
    .dark-theme .results-tabs::-webkit-scrollbar-thumb,
    .dark-theme .key-list::-webkit-scrollbar-thumb,
    .dark-theme #apiKeys::-webkit-scrollbar-thumb {
      background: #4c63d2;
      border-radius: 4px;
    }

    .dark-theme .model-list-container::-webkit-scrollbar-thumb:hover,
    .dark-theme .results-tabs::-webkit-scrollbar-thumb:hover,
    .dark-theme .key-list::-webkit-scrollbar-thumb:hover,
    .dark-theme #apiKeys::-webkit-scrollbar-thumb:hover {
      background: #5a73e0;
    }

    /* ç²˜è´´æŒ‰é’®æ ·å¼ */
    .textarea-wrapper {
      position: relative;
    }

    .paste-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
      z-index: 10;
    }

    .paste-btn:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }

    .paste-btn:active {
      transform: scale(0.95);
    }

    .dark-theme .paste-btn {
      background: #2a2d47;
      border-color: #3c4269;
      color: #e8eaed;
    }

    .dark-theme .paste-btn:hover {
      background: #323556;
      border-color: #4c63d2;
    }

    /* æ ‡ç­¾å’Œå¯¼å…¥æŒ‰é’®æ ·å¼ */
    .label-with-import {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .import-btn {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .import-btn:hover {
      background: #e9ecef;
      border-color: #adb5bd;
    }

    .import-btn:active {
      transform: scale(0.95);
    }

    .dark-theme .import-btn {
      background: #2a2d47;
      border-color: #3c4269;
      color: #e8eaed;
    }

    .dark-theme .import-btn:hover {
      background: #323556;
      border-color: #4c63d2;
    }
  </style>
</head>

<body>
  <!-- ä¸»é¢˜åˆ‡æ¢æ§åˆ¶æŒ‰é’® -->
  <div class="theme-controls">
    <button class="control-btn" id="langBtn" title="åˆ‡æ¢è¯­è¨€">ğŸŒ</button>
    <button class="control-btn" id="themeBtn" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
  </div>

  <div class="container">
    <div class="header">
      <h1 data-lang-key="title">ğŸ”‘ AI Key æµ‹æ´»å·¥å…·</h1>
      <p data-lang-key="subtitle">æ‰¹é‡æ£€æµ‹ Geminiã€Claudeã€GPT API å¯†é’¥æœ‰æ•ˆæ€§</p>
    </div>

    <div class="main-content">
      <div class="input-section">
        <div class="input-group">
          <label for="apiType" data-lang-key="select-api">é€‰æ‹© API ç±»å‹</label>
          <select id="apiType" class="form-control">
            <option value="claude">Claude</option>
            <option value="gemini">Google Gemini</option>
            <option value="openai">OpenAI GPT</option>
          </select>
        </div>

        <div class="input-group">
          <label for="modelInput" data-lang-key="select-model">æµ‹è¯•æ¨¡å‹</label>
          <div class="model-input-group">
            <select id="modelSelect" class="form-control">
              <!-- æ¨¡å‹é€‰é¡¹ä¼šæ ¹æ®APIç±»å‹åŠ¨æ€æ›´æ–° -->
            </select>
            <input type="text" id="modelInput" class="form-control hidden" data-lang-key="model-input-placeholder"
              placeholder="è¾“å…¥è‡ªå®šä¹‰æ¨¡å‹å">
            <button type="button" class="model-toggle-btn" id="modelToggleBtn" data-lang-key="custom-model">è‡ªå®šä¹‰</button>
          </div>
          <small class="form-help" data-lang-key="model-help">å¯ä»¥é€‰æ‹©é¢„è®¾æ¨¡å‹æˆ–è¾“å…¥è‡ªå®šä¹‰æ¨¡å‹å</small>
        </div>

        <div class="detected-models" id="detectedModels">
          <div class="detected-models-header" id="detectedModelsHeader">
            <h4 data-lang-key="detected-models-title">æ£€æµ‹åˆ°çš„å¯ç”¨æ¨¡å‹</h4>
            <span class="collapse-icon collapsed" id="collapseIcon">â–¼</span>
          </div>
          <div class="model-list-container" id="modelListContainer">
            <div class="model-list" id="modelList"></div>
          </div>
        </div>

        <div class="input-group">
          <label for="proxyUrl" data-lang-key="proxy-url">ä»£ç†æœåŠ¡å™¨ URL (å¯é€‰)</label>
          <input type="text" id="proxyUrl" class="form-control" placeholder="https://your-proxy.com">
          <small class="form-help">
            &nbsp;&nbsp;1. ç•™ç©ºä½¿ç”¨é»˜è®¤ä»£ç†ï¼Œå»ºè®®ä½¿ç”¨è‡ªå·±çš„åå‘ä»£ç†ä»¥æé«˜æˆåŠŸç‡<br>
            &nbsp;&nbsp;2. å¸¸ç”¨çš„ä¸­è½¬ç«™URLï¼š<br>&nbsp;&nbsp;&nbsp;&nbsp;
              2.1.<span style="color: orange">instcopilot:</span> https://instcopilot-api.com/v1<br>&nbsp;&nbsp;&nbsp;&nbsp;
              2.2.<span style="color: orange">wenwencode: </span>https://code.wenwen-ai.com/v1<br>&nbsp;&nbsp;&nbsp;&nbsp;
              2.3.<span style="color: orange">aicodeditor: </span>https://api.aicodeditor.com/v1<br>&nbsp;&nbsp;&nbsp;&nbsp;
              2.4.<span style="color: orange">catsapi: </span>https://catsapi.com/v1<br>&nbsp;&nbsp;&nbsp;&nbsp;
              2.5.<span style="color: orange">anyrouter: </span>https://anyrouter.top/v1<br>&nbsp;&nbsp;&nbsp;&nbsp;
              2.6.<span style="color: orange">zone: </span>https://zone.veloera.org/v1
          </small>
        </div>

        <div class="input-group">
          <div class="label-with-import">
            <label for="apiKeys" data-lang-key="api-keys">API å¯†é’¥åˆ—è¡¨ (æ¯è¡Œä¸€ä¸ª)</label>
            <button class="import-btn" id="importBtn" title="å¯¼å…¥æ–‡ä»¶">ğŸ“</button>
          </div>
          <div class="textarea-wrapper">
            <textarea id="apiKeys" class="form-control textarea" data-lang-key="api-keys-placeholder"
              placeholder="è¯·è¾“å…¥APIå¯†é’¥ï¼Œæ¯è¡Œä¸€ä¸ªï¼š&#10;sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#10;sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#10;..."></textarea>
            <button class="paste-btn" id="pasteBtn" title="ç²˜è´´">ğŸ“‹</button>
          </div>
          <input type="file" id="fileInput" accept=".txt" style="display: none;">
        </div>

        <!-- å¹¶å‘æ§åˆ¶ -->
        <div class="input-group">
          <label data-lang-key="concurrency-control">å¹¶å‘æ§åˆ¶</label>
          <div class="concurrency-container">
            <div class="concurrency-input-section">
              <input type="number" id="concurrencyInput" class="form-control" value="5" min="1">
            </div>
            <div class="slider-section">
              <div class="slider-container">
                <input type="range" id="concurrencySlider" class="slider" min="1" max="50" value="5">
                <span class="slider-value" id="sliderValue">5</span>
              </div>
              <div class="preset-buttons">
                <button type="button" class="preset-btn" data-concurrency="1" data-lang-key="slow">æ…¢é€Ÿ</button>
                <button type="button" class="preset-btn active" data-concurrency="5" data-lang-key="normal">æ­£å¸¸</button>
                <button type="button" class="preset-btn" data-concurrency="10" data-lang-key="fast">å¿«é€Ÿ</button>
                <button type="button" class="preset-btn" data-concurrency="20" data-lang-key="ultra">æé€Ÿ</button>
              </div>
            </div>
          </div>
        </div>

        <!-- é‡è¯•æ§åˆ¶ -->
        <div class="input-group">
          <label data-lang-key="retry-control">é‡è¯•æ§åˆ¶</label>
          <div class="retry-container">
            <div class="retry-input-section">
              <input type="number" id="retryInput" class="form-control" value="3" min="0" max="10">
            </div>
            <div class="retry-slider-section">
              <div class="retry-slider-container">
                <input type="range" id="retrySlider" class="retry-slider" min="0" max="10" value="3">
                <span class="retry-slider-value" id="retrySliderValue">3</span>
              </div>
              <div class="retry-preset-buttons">
                <button type="button" class="retry-preset-btn" data-retry="0" data-lang-key="no-retry">ä¸é‡è¯•</button>
                <button type="button" class="retry-preset-btn" data-retry="2" data-lang-key="light-retry">è½»åº¦</button>
                <button type="button" class="retry-preset-btn active" data-retry="3"
                  data-lang-key="normal-retry">æ­£å¸¸</button>
                <button type="button" class="retry-preset-btn" data-retry="5" data-lang-key="heavy-retry">é‡åº¦</button>
              </div>
            </div>
          </div>
          <small class="form-help" data-lang-key="retry-help">é‡åˆ°ä¸´æ—¶é”™è¯¯(å¦‚403)æ—¶é‡è¯•æ¬¡æ•°ï¼Œæœ‰åŠ©äºæé«˜æ£€æµ‹å‡†ç¡®æ€§</small>
        </div>

        <div class="alert">
          <strong data-lang-key="usage-title">ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</strong>
          <br><span data-lang-key="usage-1">â€¢ å¼ºçƒˆå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰ä»£ç†URLï¼Œå…¬å…±ä»£ç†å¯èƒ½ä¸ç¨³å®š</span>
          <br><span data-lang-key="usage-2">â€¢ Geminiä»£ç†ç¤ºä¾‹: https://gemini.weiruchenai.me/v1beta</span>
          <br><span data-lang-key="usage-3">â€¢ OpenAIä»£ç†ç¤ºä¾‹: https://openai.weiruchenai.me/v1</span>
          <br><span data-lang-key="usage-4">â€¢ Claudeä»£ç†ç¤ºä¾‹: https://claude.weiruchenai.me/v1</span>
          <br><span data-lang-key="usage-5">â€¢ ç›´æ¥è®¿é—®å®˜æ–¹APIä¼šå› CORSé™åˆ¶å¤±è´¥</span>
          <br><span data-lang-key="usage-6">â€¢ æµ‹è¯•è¿‡ç¨‹ä¸­å¯†é’¥ä»…ç”¨äºéªŒè¯ï¼Œä¸ä¼šè¢«å­˜å‚¨</span>
          <br><span data-lang-key="usage-7">â€¢ æ™ºèƒ½é‡è¯•æœºåˆ¶å¯æé«˜æ£€æµ‹å‡†ç¡®æ€§ï¼Œå‡å°‘è¯¯åˆ¤</span>
        </div>

        <div class="button-group">
          <button class="btn btn-detect" id="detectBtn" data-lang-key="detect-models">æ£€æµ‹æ¨¡å‹</button>
          <button class="btn btn-primary" id="startBtn" data-lang-key="start-test">å¼€å§‹æµ‹è¯•</button>
          <button class="btn btn-secondary" id="dedupeBtn" data-lang-key="dedupe-keys">å»é‡å¯†é’¥</button>
          <button class="btn btn-secondary" id="clearBtn" data-lang-key="clear">æ¸…ç©º</button>
        </div>
      </div>

      <div class="progress-bar hidden" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="loading hidden" id="loading">
        <div class="spinner"></div>
        <p data-lang-key="testing">æ­£åœ¨æµ‹è¯• API å¯†é’¥...</p>
      </div>

      <div class="results-section hidden" id="resultsSection">
        <div class="stats">
          <div class="stat-card">
            <div class="stat-number total" id="totalCount">0</div>
            <div class="stat-label" data-lang-key="total">æ€»è®¡</div>
          </div>
          <div class="stat-card">
            <div class="stat-number valid" id="validCount">0</div>
            <div class="stat-label" data-lang-key="valid">æœ‰æ•ˆ</div>
          </div>
          <div class="stat-card">
            <div class="stat-number invalid" id="invalidCount">0</div>
            <div class="stat-label" data-lang-key="invalid">æ— æ•ˆ</div>
          </div>
          <div class="stat-card">
            <div class="stat-number rate-limited" id="rateLimitedCount">0</div>
            <div class="stat-label" data-lang-key="rate-limited">é€Ÿç‡é™åˆ¶</div>
          </div>
          <div class="stat-card">
            <div class="stat-number testing" id="testingCount">0</div>
            <div class="stat-label" data-lang-key="testing-label">æµ‹è¯•ä¸­</div>
          </div>
          <div class="stat-card">
            <div class="stat-number retrying" id="retryingCount">0</div>
            <div class="stat-label" data-lang-key="retrying">é‡è¯•ä¸­</div>
          </div>
        </div>

        <div class="results-tabs">
          <button class="tab active" data-tab="all" data-lang-key="all">å…¨éƒ¨</button>
          <button class="tab" data-tab="valid" data-lang-key="valid-keys">æœ‰æ•ˆå¯†é’¥</button>
          <button class="tab" data-tab="invalid" data-lang-key="invalid-keys">æ— æ•ˆå¯†é’¥</button>
          <button class="tab" data-tab="rate-limited" data-lang-key="rate-limited-keys">é€Ÿç‡é™åˆ¶</button>
        </div>

        <div class="tab-content active" id="allTab">
          <div class="key-list" id="allKeys"></div>
          <button class="copy-btn" data-copy="all" data-lang-key="copy-all">å¤åˆ¶å…¨éƒ¨</button>
        </div>

        <div class="tab-content" id="validTab">
          <div class="key-list" id="validKeys"></div>
          <button class="copy-btn" data-copy="valid" data-lang-key="copy-valid">å¤åˆ¶æœ‰æ•ˆå¯†é’¥</button>
        </div>

        <div class="tab-content" id="invalidTab">
          <div class="key-list" id="invalidKeys"></div>
          <button class="copy-btn" data-copy="invalid" data-lang-key="copy-invalid">å¤åˆ¶æ— æ•ˆå¯†é’¥</button>
        </div>

        <div class="tab-content" id="rateLimitedTab">
          <div class="key-list" id="rateLimitedKeys"></div>
          <button class="copy-btn" data-copy="rate-limited" data-lang-key="copy-rate-limited">å¤åˆ¶é€Ÿç‡é™åˆ¶å¯†é’¥</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let allKeysData = [];
    let currentLang = 'zh';
    let isDarkTheme = false;
    let isCustomModel = false;
    let detectedModels = new Set();
    let currentConcurrency = 5;
    let currentRetryCount = 3;
    let isTestingInProgress = false;
    let shouldCancelTesting = false;
    let completedCount = 0;
    let totalCount = 0;
    let updateTimer = null;

    // æ¨¡å‹é…ç½® - ä½¿ç”¨å®˜æ–¹åç§°
    const modelOptions = {
      claude: [
        'claude-sonnet-4-20250514',
        'claude-opus-4-20250514',
        'claude-3-7-sonnet-20250219'
      ],
      gemini: [
        'gemini-2.5-flash',
        'gemini-2.5-pro'
      ],
      openai: [
        'gpt-4o-mini',
        'gpt-4-turbo',
        'gpt-4o',
        'gpt-4',
      ]
    };

    const translations = {
      zh: {
        'title': 'ğŸ”‘ API Key æµ‹æ´»å·¥å…·',
        'subtitle': 'æ‰¹é‡æ£€æµ‹ Geminiã€Claudeã€GPT API å¯†é’¥æœ‰æ•ˆæ€§',
        'select-api': 'é€‰æ‹© API ç±»å‹',
        'select-model': 'æµ‹è¯•æ¨¡å‹',
        'custom-model': 'è‡ªå®šä¹‰',
        'preset-model': 'é¢„è®¾',
        'model-help': 'å¯ä»¥é€‰æ‹©é¢„è®¾æ¨¡å‹æˆ–è¾“å…¥è‡ªå®šä¹‰æ¨¡å‹å',
        'model-input-placeholder': 'è¾“å…¥è‡ªå®šä¹‰æ¨¡å‹å',
        'detected-models-title': 'æ£€æµ‹åˆ°çš„å¯ç”¨æ¨¡å‹',
        'proxy-url': 'ä»£ç†æœåŠ¡å™¨ URL (å¯é€‰)',
        'concurrency-control': 'å¹¶å‘æ§åˆ¶',
        'retry-control': 'é‡è¯•æ§åˆ¶',
        'retry-help': 'é‡åˆ°ä¸´æ—¶é”™è¯¯(å¦‚403)æ—¶é‡è¯•æ¬¡æ•°ï¼Œæœ‰åŠ©äºæé«˜æ£€æµ‹å‡†ç¡®æ€§',
        'slow': 'æ…¢é€Ÿ',
        'normal': 'æ­£å¸¸',
        'fast': 'å¿«é€Ÿ',
        'ultra': 'æé€Ÿ',
        'no-retry': 'ä¸é‡è¯•',
        'light-retry': 'è½»åº¦',
        'normal-retry': 'æ­£å¸¸',
        'heavy-retry': 'é‡åº¦',
        'api-keys': 'API å¯†é’¥åˆ—è¡¨ (æ¯è¡Œä¸€ä¸ª)',
        'api-keys-placeholder': 'è¯·è¾“å…¥APIå¯†é’¥ï¼Œæ¯è¡Œä¸€ä¸ªï¼š\nsk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nsk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n...',
        'usage-title': 'ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š',
        'usage-1': 'â€¢ å¼ºçƒˆå»ºè®®ä½¿ç”¨è‡ªå®šä¹‰ä»£ç†URLï¼Œå…¬å…±ä»£ç†å¯èƒ½ä¸ç¨³å®š',
        'usage-2': 'â€¢ Geminiä»£ç†ç¤ºä¾‹: https://gemini.weiruchenai.me/v1beta',
        'usage-3': 'â€¢ OpenAIä»£ç†ç¤ºä¾‹: https://openai.weiruchenai.me/v1',
        'usage-4': 'â€¢ Claudeä»£ç†ç¤ºä¾‹: https://claude.weiruchenai.me/v1',
        'usage-5': 'â€¢ ç›´æ¥è®¿é—®å®˜æ–¹APIä¼šå› CORSé™åˆ¶å¤±è´¥',
        'usage-6': 'â€¢ æµ‹è¯•è¿‡ç¨‹ä¸­å¯†é’¥ä»…ç”¨äºéªŒè¯ï¼Œä¸ä¼šè¢«å­˜å‚¨',
        'usage-7': 'â€¢ æ™ºèƒ½é‡è¯•æœºåˆ¶å¯æé«˜æ£€æµ‹å‡†ç¡®æ€§ï¼Œå‡å°‘è¯¯åˆ¤',
        'detect-models': 'æ£€æµ‹æ¨¡å‹',
        'start-test': 'å¼€å§‹æµ‹è¯•',
        'cancel-test': 'å–æ¶ˆæµ‹è¯•',
        'dedupe-keys': 'å»é‡å¯†é’¥',
        'clear': 'æ¸…ç©º',
        'testing': 'æ­£åœ¨æµ‹è¯• API å¯†é’¥...',
        'detecting': 'æ­£åœ¨æ£€æµ‹å¯ç”¨æ¨¡å‹...',
        'no-models-detected': 'æ— å¯ç”¨æ¨¡å‹',
        'total': 'æ€»è®¡',
        'valid': 'æœ‰æ•ˆ',
        'invalid': 'æ— æ•ˆ',
        'rate-limited': 'é€Ÿç‡é™åˆ¶',
        'testing-label': 'æµ‹è¯•ä¸­',
        'retrying': 'é‡è¯•ä¸­',
        'all': 'å…¨éƒ¨',
        'valid-keys': 'æœ‰æ•ˆå¯†é’¥',
        'invalid-keys': 'æ— æ•ˆå¯†é’¥',
        'rate-limited-keys': 'é€Ÿç‡é™åˆ¶',
        'copy-all': 'å¤åˆ¶å…¨éƒ¨',
        'copy-valid': 'å¤åˆ¶æœ‰æ•ˆå¯†é’¥',
        'copy-invalid': 'å¤åˆ¶æ— æ•ˆå¯†é’¥',
        'copy-rate-limited': 'å¤åˆ¶é€Ÿç‡é™åˆ¶å¯†é’¥',
        'status-valid': 'æœ‰æ•ˆ',
        'status-invalid': 'æ— æ•ˆ',
        'status-rate-limited': 'é€Ÿç‡é™åˆ¶',
        'status-testing': 'æµ‹è¯•ä¸­',
        'status-retrying': 'é‡è¯•ä¸­'
      },
      en: {
        'title': 'ğŸ”‘ API Key Tester',
        'subtitle': 'Batch test Gemini, Claude, GPT API key validity',
        'select-api': 'Select API Type',
        'select-model': 'Test Model',
        'custom-model': 'Custom',
        'preset-model': 'Preset',
        'model-help': 'Choose preset model or enter custom model name',
        'model-input-placeholder': 'Enter custom model name',
        'detected-models-title': 'Detected Available Models',
        'proxy-url': 'Proxy Server URL (Optional)',
        'concurrency-control': 'Concurrency Control',
        'retry-control': 'Retry Control',
        'retry-help': 'Number of retries when encountering temporary errors (like 403), helps improve detection accuracy',
        'slow': 'Slow',
        'normal': 'Normal',
        'fast': 'Fast',
        'ultra': 'Ultra',
        'no-retry': 'No Retry',
        'light-retry': 'Light',
        'normal-retry': 'Normal',
        'heavy-retry': 'Heavy',
        'api-keys': 'API Key List (one per line)',
        'api-keys-placeholder': 'Enter API keys, one per line:\nsk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nsk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n...',
        'usage-title': 'ğŸ’¡ Usage Instructions:',
        'usage-1': 'â€¢ Strongly recommend using custom proxy URL, public proxies may be unstable',
        'usage-2': 'â€¢ Gemini proxy example: https://gemini.weiruchenai.me/v1beta',
        'usage-3': 'â€¢ OpenAI proxy example: https://openai.weiruchenai.me/v1',
        'usage-4': 'â€¢ Claude proxy example: https://claude.weiruchenai.me/v1',
        'usage-5': 'â€¢ Direct access to official APIs will fail due to CORS restrictions',
        'usage-6': 'â€¢ Keys are only used for validation during testing, not stored',
        'usage-7': 'â€¢ Smart retry mechanism improves detection accuracy and reduces false negatives',
        'detect-models': 'Detect Models',
        'start-test': 'Start Test',
        'cancel-test': 'Cancel Test',
        'dedupe-keys': 'Dedupe Keys',
        'clear': 'Clear',
        'testing': 'Testing API keys...',
        'detecting': 'Detecting available models...',
        'no-models-detected': 'No Available Models',
        'total': 'Total',
        'valid': 'Valid',
        'invalid': 'Invalid',
        'rate-limited': 'Rate Limited',
        'testing-label': 'Testing',
        'retrying': 'Retrying',
        'all': 'All',
        'valid-keys': 'Valid Keys',
        'invalid-keys': 'Invalid Keys',
        'rate-limited-keys': 'Rate Limited',
        'copy-all': 'Copy All',
        'copy-valid': 'Copy Valid Keys',
        'copy-invalid': 'Copy Invalid Keys',
        'copy-rate-limited': 'Copy Rate Limited Keys',
        'status-valid': 'Valid',
        'status-invalid': 'Invalid',
        'status-rate-limited': 'Rate Limited',
        'status-testing': 'Testing',
        'status-retrying': 'Retrying'
      }
    };

    async function testApiKeyWithRetry(apiKey, apiType, maxRetries = 0) {
      const keyData = allKeysData.find(k => k.key === apiKey);

      for (let attempt = 0; attempt <= maxRetries; attempt++) {
        try {
          // æ›´æ–°çŠ¶æ€å’ŒUI
          if (keyData) {
            if (attempt === 0) {
              keyData.status = 'testing';
              keyData.retryCount = 0;
            } else {
              keyData.status = 'retrying';
              keyData.retryCount = attempt;
              // ä¼˜åŒ–é‡è¯•å»¶è¿Ÿ
              await new Promise(resolve => setTimeout(resolve, 300 + Math.random() * 500));
            }
            updateUIAsync();
          }

          // æ‰§è¡Œå®é™…æµ‹è¯•
          const result = await testApiKey(apiKey, apiType);

          // æˆåŠŸæˆ–é€Ÿç‡é™åˆ¶ï¼šç›´æ¥è¿”å›ï¼Œä¸é‡è¯•
          if (result.valid || result.isRateLimit) {
            return finalizeResult(keyData, result, attempt);
          }

          // æœ€åä¸€æ¬¡å°è¯•ï¼šæ— è®ºç»“æœå¦‚ä½•éƒ½è¿”å›
          if (attempt === maxRetries) {
            return finalizeResult(keyData, result, attempt);
          }

          // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡è¯•
          const statusCode = extractStatusCode(result.error);
          if (!shouldRetry(result.error, statusCode)) {
            // ä¸éœ€è¦é‡è¯•çš„é”™è¯¯ç›´æ¥è¿”å›
            return finalizeResult(keyData, result, attempt);
          }

          // ç»§ç»­ä¸‹ä¸€æ¬¡é‡è¯•...
          // é‡è¯•é€»è¾‘

        } catch (error) {
          console.error(`æµ‹è¯•å¯†é’¥ ${apiKey.substring(0, 10)}... ç¬¬ ${attempt + 1} æ¬¡å°è¯•å¼‚å¸¸:`, error);

          if (attempt === maxRetries) {
            const errorResult = {
              valid: false,
              error: 'æµ‹è¯•å¼‚å¸¸: ' + error.message,
              isRateLimit: false
            };
            return finalizeResult(keyData, errorResult, attempt);
          }

          // å¼‚å¸¸ä¹Ÿå¯ä»¥é‡è¯•
          if (keyData) {
            keyData.status = 'retrying';
            keyData.retryCount = attempt + 1;
            updateUIAsync();
          }
        }
      }
    }

    // å®Œæˆæµ‹è¯•ç»“æœå¤„ç†
    function finalizeResult(keyData, result, retryCount) {
      if (keyData) {
        keyData.retryCount = retryCount;
        keyData.error = result.error;

        if (result.valid) {
          keyData.status = 'valid';
        } else if (result.isRateLimit) {
          keyData.status = 'rate-limited';
        } else {
          keyData.status = 'invalid';
        }
      }
      return result;
    }

    // ä¿®å¤åçš„ä¸»æµ‹è¯•å‡½æ•°
    async function startTesting() {
      // å¦‚æœæ­£åœ¨æµ‹è¯•ï¼Œåˆ™å–æ¶ˆæµ‹è¯•
      if (isTestingInProgress) {
        shouldCancelTesting = true;
        return;
      }

      const apiType = document.getElementById('apiType').value;
      const apiKeysText = document.getElementById('apiKeys').value.trim();
      const selectedModel = getSelectedModel();

      if (!apiKeysText) {
        alert(currentLang === 'zh' ? 'è¯·è¾“å…¥APIå¯†é’¥ï¼' : 'Please enter API keys!');
        return;
      }

      if (!selectedModel) {
        alert(currentLang === 'zh' ? 'è¯·é€‰æ‹©æˆ–è¾“å…¥æ¨¡å‹åï¼' : 'Please select or enter model name!');
        return;
      }

      const rawKeys = apiKeysText.split('\n').filter(key => key.trim());

      if (rawKeys.length === 0) {
        alert(currentLang === 'zh' ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„APIå¯†é’¥ï¼' : 'Please enter valid API keys!');
        return;
      }

      // å»é‡å¤„ç†
      const { uniqueKeys, duplicates } = deduplicateAndCleanKeys(rawKeys);

      // å¦‚æœå‘ç°é‡å¤å¯†é’¥ï¼Œæç¤ºç”¨æˆ·
      if (duplicates.length > 0) {
        const message = currentLang === 'zh' ?
          `å‘ç° ${duplicates.length} ä¸ªé‡å¤å¯†é’¥ï¼Œå·²è‡ªåŠ¨å»é™¤ã€‚å°†æµ‹è¯• ${uniqueKeys.length} ä¸ªå”¯ä¸€å¯†é’¥ã€‚` :
          `Found ${duplicates.length} duplicate keys, automatically removed. Will test ${uniqueKeys.length} unique keys.`;
        alert(message);
      }

      // è®¾ç½®æµ‹è¯•çŠ¶æ€
      isTestingInProgress = true;
      shouldCancelTesting = false;
      completedCount = 0;
      totalCount = uniqueKeys.length;

      // æ›´æ–°æŒ‰é’®æ–‡æœ¬
      updateStartButtonText();

      // é‡ç½®æ•°æ®
      allKeysData = [];

      // åˆå§‹åŒ–æ‰€æœ‰å¯†é’¥ä¸ºpendingçŠ¶æ€
      uniqueKeys.forEach(apiKey => {
        const keyData = {
          key: apiKey,
          status: 'pending',
          error: null,
          type: apiType,
          model: selectedModel,
          retryCount: 0
        };
        allKeysData.push(keyData);
      });

      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('progressBar').classList.remove('hidden');
      document.getElementById('resultsSection').classList.remove('hidden');

      updateStats();
      updateKeyLists();

      try {
        // ä½¿ç”¨æ­£ç¡®çš„å›ºå®šå¹¶å‘å¤„ç†
        await processWithFixedConcurrency(uniqueKeys, apiType);
      } catch (error) {
        // æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œæ¸…ç†æ“ä½œ
      } finally {
        // ç¡®ä¿æµ‹è¯•å®Œæˆåæ¸…ç†çŠ¶æ€
        isTestingInProgress = false;
        shouldCancelTesting = false;
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('progressBar').classList.add('hidden');

        // æ›´æ–°æŒ‰é’®æ–‡æœ¬
        updateStartButtonText();

        // æœ€ç»ˆæ›´æ–°ç»Ÿè®¡å’Œåˆ—è¡¨
        updateStats();
        updateKeyLists();

        // æ˜¾ç¤ºæµ‹è¯•å®Œæˆæç¤º
        if (!shouldCancelTesting) {
          showCompletionMessage();
        }
      }
    }

    // æ­£ç¡®çš„å›ºå®šå¹¶å‘å¤„ç†é€»è¾‘
    async function processWithFixedConcurrency(apiKeys, apiType) {
      const keyQueue = [...apiKeys];
      const activeSlots = new Array(currentConcurrency).fill(null);
      let nextKeyIndex = 0;

      // å¼€å§‹æµ‹è¯•å¤„ç†

      // åˆå§‹å¡«æ»¡æ‰€æœ‰å¹¶å‘æ§½ä½
      for (let i = 0; i < currentConcurrency && i < keyQueue.length; i++) {
        activeSlots[i] = startKeyTest(keyQueue[nextKeyIndex], apiType, i);
        nextKeyIndex++;
      }

      // æŒç»­å¤„ç†ç›´åˆ°æ‰€æœ‰å¯†é’¥å®Œæˆæˆ–è¢«å–æ¶ˆ
      while (activeSlots.some(slot => slot !== null) && !shouldCancelTesting) {
        // ç­‰å¾…ä»»æ„ä¸€ä¸ªæ§½ä½å®Œæˆ
        const completedIndex = await waitForAnySlotCompletion(activeSlots);

        // æ›´æ–°è¿›åº¦
        completedCount++;
        updateProgress();

        // æ£€æŸ¥æ˜¯å¦åº”è¯¥å–æ¶ˆ
        if (shouldCancelTesting) {
          break;
        }

        // å¦‚æœè¿˜æœ‰å¾…æµ‹è¯•çš„å¯†é’¥ï¼Œå¯åŠ¨æ–°çš„æµ‹è¯•å ç”¨è¿™ä¸ªæ§½ä½
        if (nextKeyIndex < keyQueue.length) {
          activeSlots[completedIndex] = startKeyTest(keyQueue[nextKeyIndex], apiType, completedIndex);
          nextKeyIndex++;
        } else {
          // æ²¡æœ‰æ–°å¯†é’¥äº†ï¼Œé‡Šæ”¾æ§½ä½
          activeSlots[completedIndex] = null;
        }
      }

      // æµ‹è¯•å®Œæˆ
    }

    // æ›´æ–°å¼€å§‹æŒ‰é’®æ–‡æœ¬
    function updateStartButtonText() {
      const startBtn = document.getElementById('startBtn');
      if (isTestingInProgress) {
        startBtn.textContent = translations[currentLang]['cancel-test'];
        startBtn.setAttribute('data-lang-key', 'cancel-test');
      } else {
        startBtn.textContent = translations[currentLang]['start-test'];
        startBtn.setAttribute('data-lang-key', 'start-test');
      }
    }

    // å¯åŠ¨å•ä¸ªå¯†é’¥æµ‹è¯•
    async function startKeyTest(apiKey, apiType, slotIndex) {
      // å¼€å§‹æµ‹è¯•å¯†é’¥

      try {
        const result = await testApiKeyWithRetry(apiKey, apiType, currentRetryCount);
        // æµ‹è¯•å®Œæˆ
        return result;
      } catch (error) {
        // å¤„ç†æµ‹è¯•å¼‚å¸¸

        // å¤„ç†æµ‹è¯•å¼‚å¸¸
        const keyData = allKeysData.find(k => k.key === apiKey);
        if (keyData) {
          keyData.status = 'invalid';
          keyData.error = 'æµ‹è¯•å¼‚å¸¸: ' + error.message;
        }
        return { valid: false, error: error.message, isRateLimit: false };
      } finally {
        updateUIAsync();
      }
    }

    // ç­‰å¾…ä»»æ„æ§½ä½å®Œæˆ
    async function waitForAnySlotCompletion(activeSlots) {
      const activePromises = activeSlots
        .map((promise, index) => promise ? promise.then(() => index) : null)
        .filter(p => p !== null);

      if (activePromises.length === 0) {
        throw new Error('æ²¡æœ‰æ´»è·ƒçš„æµ‹è¯•ä»»åŠ¡');
      }

      return await Promise.race(activePromises);
    }

    // å¼‚æ­¥æ›´æ–°UI
    function updateUIAsync() {
      if (updateTimer) return;

      updateTimer = setTimeout(() => {
        updateStats();
        updateKeyLists();
        updateTimer = null;
      }, 50);
    }

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress() {
      const progress = (completedCount / totalCount) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
    }

    // åˆ¤æ–­æ˜¯å¦éœ€è¦é‡è¯•
    function shouldRetry(error, statusCode) {
      // 403ã€502ã€503ã€504 ç­‰ä¸´æ—¶é”™è¯¯éœ€è¦é‡è¯•
      if ([403, 502, 503, 504].includes(statusCode)) {
        return true;
      }

      if (error && typeof error === 'string') {
        const errorLower = error.toLowerCase();
        if (errorLower.includes('timeout') ||
          errorLower.includes('network') ||
          errorLower.includes('è¿æ¥') ||
          errorLower.includes('fetch')) {
          return true;
        }
      }

      return false;
    }

    // æå–HTTPçŠ¶æ€ç 
    function extractStatusCode(error) {
      if (!error || typeof error !== 'string') return null;

      const match = error.match(/\((\d{3})\)/);
      if (match) {
        return parseInt(match[1]);
      }

      if (error.includes('HTTP ')) {
        const httpMatch = error.match(/HTTP (\d{3})/);
        if (httpMatch) {
          return parseInt(httpMatch[1]);
        }
      }

      return null;
    }

    // æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯
    function showCompletionMessage() {
      const validCount = allKeysData.filter(k => k.status === 'valid').length;
      const invalidCount = allKeysData.filter(k => k.status === 'invalid').length;
      const rateLimitedCount = allKeysData.filter(k => k.status === 'rate-limited').length;

      const message = currentLang === 'zh' ?
        `æµ‹è¯•å®Œæˆï¼æœ‰æ•ˆå¯†é’¥: ${validCount}ï¼Œæ— æ•ˆå¯†é’¥: ${invalidCount}ï¼Œé€Ÿç‡é™åˆ¶: ${rateLimitedCount}` :
        `Test completed! Valid keys: ${validCount}, Invalid keys: ${invalidCount}, Rate limited: ${rateLimitedCount}`;
      alert(message);
    }

    // é‡è¯•æ§åˆ¶ç›¸å…³å‡½æ•°
    function updateRetryCount(value) {
      currentRetryCount = parseInt(value);
      document.getElementById('retryInput').value = currentRetryCount;
      document.getElementById('retrySlider').value = currentRetryCount;
      document.getElementById('retrySliderValue').textContent = currentRetryCount;

      // æ›´æ–°é¢„è®¾æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.retry-preset-btn').forEach(btn => {
        btn.classList.remove('active');
        if (parseInt(btn.getAttribute('data-retry')) === currentRetryCount) {
          btn.classList.add('active');
        }
      });
    }

    function initRetryControls() {
      const input = document.getElementById('retryInput');
      const slider = document.getElementById('retrySlider');
      const presetButtons = document.querySelectorAll('.retry-preset-btn');

      // è¾“å…¥æ¡†å˜åŒ–
      input.addEventListener('input', (e) => {
        let value = parseInt(e.target.value);
        if (isNaN(value) || value < 0) value = 0;
        if (value > 10) value = 10;
        e.target.value = value;
        updateRetryCount(value);
      });

      // æ»‘å—å˜åŒ–
      slider.addEventListener('input', (e) => {
        updateRetryCount(e.target.value);
      });

      // é¢„è®¾æŒ‰é’®
      presetButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const value = parseInt(btn.getAttribute('data-retry'));
          updateRetryCount(value);
        });
      });

      // åˆå§‹åŒ–
      updateRetryCount(3);
    }

    // å¹¶å‘æ§åˆ¶ç›¸å…³å‡½æ•°
    function updateConcurrency(value) {
      currentConcurrency = parseInt(value);
      document.getElementById('concurrencyInput').value = currentConcurrency;
      document.getElementById('concurrencySlider').value = Math.min(currentConcurrency, 50);
      document.getElementById('sliderValue').textContent = currentConcurrency;

      // æ›´æ–°é¢„è®¾æŒ‰é’®çŠ¶æ€
      document.querySelectorAll('.preset-btn').forEach(btn => {
        btn.classList.remove('active');
        if (parseInt(btn.getAttribute('data-concurrency')) === currentConcurrency) {
          btn.classList.add('active');
        }
      });
    }

    function initConcurrencyControls() {
      const input = document.getElementById('concurrencyInput');
      const slider = document.getElementById('concurrencySlider');
      const presetButtons = document.querySelectorAll('.preset-btn');

      // è¾“å…¥æ¡†å˜åŒ–
      input.addEventListener('input', (e) => {
        let value = parseInt(e.target.value);
        if (isNaN(value) || value < 1) value = 1;
        e.target.value = value;
        updateConcurrency(value);
      });

      // æ»‘å—å˜åŒ–
      slider.addEventListener('input', (e) => {
        updateConcurrency(e.target.value);
      });

      // é¢„è®¾æŒ‰é’®
      presetButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const value = parseInt(btn.getAttribute('data-concurrency'));
          updateConcurrency(value);
        });
      });

      // åˆå§‹åŒ–
      updateConcurrency(5);
    }

    function updateModelOptions() {
      const apiType = document.getElementById('apiType').value;
      const modelSelect = document.getElementById('modelSelect');
      const options = modelOptions[apiType];

      modelSelect.innerHTML = '';
      options.forEach(model => {
        const optionElement = document.createElement('option');
        optionElement.value = model;
        optionElement.textContent = model;
        modelSelect.appendChild(optionElement);
      });
    }

    function toggleLanguage() {
      currentLang = currentLang === 'zh' ? 'en' : 'zh';
      updateLanguage();
    }

    function updateLanguage() {
      const elements = document.querySelectorAll('[data-lang-key]');
      elements.forEach(element => {
        const key = element.getAttribute('data-lang-key');
        if (translations[currentLang][key]) {
          if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
            element.placeholder = translations[currentLang][key];
          } else {
            element.textContent = translations[currentLang][key];
          }
        }
      });
      updateModelOptions();
      updateKeyLists();
    }

    function toggleTheme() {
      isDarkTheme = !isDarkTheme;
      const themeBtn = document.getElementById('themeBtn');

      if (isDarkTheme) {
        document.body.classList.add('dark-theme');
        themeBtn.textContent = 'â˜€ï¸';
        themeBtn.title = currentLang === 'zh' ? 'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼' : 'Switch to Light Mode';
      } else {
        document.body.classList.remove('dark-theme');
        themeBtn.textContent = 'ğŸŒ™';
        themeBtn.title = currentLang === 'zh' ? 'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼' : 'Switch to Dark Mode';
      }
    }

    function toggleModelInput() {
      isCustomModel = !isCustomModel;
      const modelSelect = document.getElementById('modelSelect');
      const modelInput = document.getElementById('modelInput');
      const toggleBtn = document.getElementById('modelToggleBtn');

      if (isCustomModel) {
        modelSelect.classList.add('hidden');
        modelInput.classList.remove('hidden');
        toggleBtn.textContent = translations[currentLang]['preset-model'];
        toggleBtn.classList.add('active');
      } else {
        modelSelect.classList.remove('hidden');
        modelInput.classList.add('hidden');
        toggleBtn.textContent = translations[currentLang]['custom-model'];
        toggleBtn.classList.remove('active');
      }
    }

    function getSelectedModel() {
      if (isCustomModel) {
        return document.getElementById('modelInput').value.trim();
      } else {
        return document.getElementById('modelSelect').value;
      }
    }

    function addDetectedModel(model) {
      if (!detectedModels.has(model)) {
        detectedModels.add(model);
        updateDetectedModelsList();
      }
    }

    function updateDetectedModelsList() {
      const modelList = document.getElementById('modelList');
      const detectedModelsDiv = document.getElementById('detectedModels');
      const modelCountSpan = document.querySelector('#detectedModelsHeader h4');

      if (detectedModels.size > 0) {
        detectedModelsDiv.style.display = 'block';

        // æ›´æ–°æ ‡é¢˜æ˜¾ç¤ºæ¨¡å‹æ•°é‡
        const titleKey = 'detected-models-title';
        const baseTitle = translations[currentLang][titleKey];
        modelCountSpan.textContent = `${baseTitle} (${detectedModels.size})`;

        modelList.innerHTML = '';

        detectedModels.forEach(model => {
          const modelTag = document.createElement('div');
          modelTag.className = 'model-tag';
          modelTag.textContent = model;
          modelTag.onclick = () => selectDetectedModel(model);
          modelList.appendChild(modelTag);
        });
      } else {
        detectedModelsDiv.style.display = 'none';
      }
    }

    function toggleModelList() {
      const container = document.getElementById('modelListContainer');
      const icon = document.getElementById('collapseIcon');

      if (container.classList.contains('expanded')) {
        container.classList.remove('expanded');
        icon.classList.add('collapsed');
      } else {
        container.classList.add('expanded');
        icon.classList.remove('collapsed');
      }
    }

    function selectDetectedModel(model) {
      if (isCustomModel) {
        document.getElementById('modelInput').value = model;
      } else {
        const modelSelect = document.getElementById('modelSelect');
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¯¥é€‰é¡¹
        let optionExists = false;
        for (let option of modelSelect.options) {
          if (option.value === model) {
            modelSelect.value = model;
            optionExists = true;
            break;
          }
        }
        // å¦‚æœä¸å­˜åœ¨ï¼Œæ·»åŠ æ–°é€‰é¡¹
        if (!optionExists) {
          const newOption = document.createElement('option');
          newOption.value = model;
          newOption.textContent = model;
          modelSelect.appendChild(newOption);
          modelSelect.value = model;
        }
      }
    }

    function getApiUrl(apiType, endpoint) {
      const proxyUrl = document.getElementById('proxyUrl').value.trim();

      if (proxyUrl) {
        const baseUrl = proxyUrl.endsWith('/') ? proxyUrl.slice(0, -1) : proxyUrl;
        return baseUrl + endpoint;
      } else {
        switch (apiType) {
          case 'openai':
            return 'https://openai.weiruchenai.me/v1' + endpoint;
          case 'claude':
            return 'https://claude.weiruchenai.me/v1' + endpoint;
          case 'gemini':
            return 'https://gemini.weiruchenai.me/v1beta' + endpoint;
        }
      }
    }

    function updateProxyPlaceholder() {
      const apiType = document.getElementById('apiType').value;
      const proxyInput = document.getElementById('proxyUrl');

      switch (apiType) {
        case 'openai':
          proxyInput.placeholder = 'https://openai.weiruchenai.me/v1';
          break;
        case 'claude':
          proxyInput.placeholder = 'https://claude.weiruchenai.me/v1';
          break;
        case 'gemini':
          proxyInput.placeholder = 'https://gemini.weiruchenai.me/v1beta';
          break;
      }

      updateModelOptions();
    }

    async function detectModels() {
      const apiType = document.getElementById('apiType').value;
      const apiKeysText = document.getElementById('apiKeys').value.trim();

      if (!apiKeysText) {
        alert(currentLang === 'zh' ? 'è¯·å…ˆè¾“å…¥APIå¯†é’¥ï¼' : 'Please enter API keys first!');
        return;
      }

      const apiKeys = apiKeysText.split('\n').filter(key => key.trim());

      if (apiKeys.length === 0) {
        alert(currentLang === 'zh' ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„APIå¯†é’¥ï¼' : 'Please enter valid API keys!');
        return;
      }

      // åªå–ç¬¬ä¸€ä¸ªkeyè¿›è¡Œæ£€æµ‹
      const testKey = apiKeys[0].trim();

      document.getElementById('loading').classList.remove('hidden');
      const loadingText = document.querySelector('#loading p');
      loadingText.textContent = translations[currentLang]['detecting'];

      detectedModels.clear();

      try {
        const models = await getAvailableModels(testKey, apiType);

        if (models && models.length > 0) {
          models.forEach(model => addDetectedModel(model));
          alert(currentLang === 'zh' ?
            `æ£€æµ‹åˆ° ${models.length} ä¸ªå¯ç”¨æ¨¡å‹` :
            `Detected ${models.length} available models`);
        } else {
          alert(currentLang === 'zh' ?
            'æœªæ£€æµ‹åˆ°å¯ç”¨æ¨¡å‹ã€‚è¯·æ£€æŸ¥ï¼š\nâ€¢ APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ\nâ€¢ ä»£ç†è®¾ç½®æ˜¯å¦æ­£ç¡®\nâ€¢ ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸' :
            'No available models detected. Please check:\nâ€¢ API key validity\nâ€¢ Proxy settings\nâ€¢ Network connection');
        }
      } catch (error) {
        alert(currentLang === 'zh' ?
          'æœªæ£€æµ‹åˆ°å¯ç”¨æ¨¡å‹ã€‚è¯·æ£€æŸ¥ï¼š\nâ€¢ APIå¯†é’¥æ˜¯å¦æœ‰æ•ˆ\nâ€¢ ä»£ç†è®¾ç½®æ˜¯å¦æ­£ç¡®\nâ€¢ ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸' :
          'No available models detected. Please check:\nâ€¢ API key validity\nâ€¢ Proxy settings\nâ€¢ Network connection');
      } finally {
        document.getElementById('loading').classList.add('hidden');
        loadingText.textContent = translations[currentLang]['testing'];
      }
    }

    async function getAvailableModels(apiKey, apiType) {
      switch (apiType) {
        case 'openai':
          return await getOpenAIModels(apiKey);
        case 'claude':
          return await getClaudeModels(apiKey);
        case 'gemini':
          return await getGeminiModels(apiKey);
        default:
          return [];
      }
    }

    async function getOpenAIModels(apiKey) {
      try {
        const apiUrl = getApiUrl('openai', '/models');

        const response = await fetch(apiUrl, {
          method: 'GET',
          headers: {
            'Authorization': 'Bearer ' + apiKey,
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          if (response.status === 401 || response.status === 403) {
            return [];
          }
          return [];
        }

        const data = await response.json();

        if (data && data.data && Array.isArray(data.data)) {
          const models = data.data
            .filter(model => {
              const id = model.id.toLowerCase();
              return !id.includes('embed') &&
                !id.includes('whisper') &&
                !id.includes('tts') &&
                !id.includes('dall-e') &&
                !id.includes('moderation') &&
                !id.includes('search') &&
                !id.includes('similarity');
            })
            .map(model => model.id)
            .sort();

          return models;
        }
        return [];
      } catch (error) {
        return [];
      }
    }

    async function getClaudeModels(apiKey) {
      const commonModels = [
        'claude-3-5-sonnet-20241022',
        'claude-3-5-sonnet-20240620',
        'claude-3-5-haiku-20241022',
        'claude-3-opus-20240229',
        'claude-3-sonnet-20240229',
        'claude-3-haiku-20240307',
      ];

      const availableModels = [];

      for (const model of commonModels) {
        try {
          const result = await testClaudeKey(apiKey, model);
          if (result.valid) {
            availableModels.push(model);
          }
        } catch (error) {
          continue;
        }
      }

      return availableModels;
    }

    async function getGeminiModels(apiKey) {
      try {
        const apiUrl = getApiUrl('gemini', '/models?key=' + apiKey);

        const response = await fetch(apiUrl, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        if (!response.ok) {
          if (response.status === 400 || response.status === 401 || response.status === 403) {
            return [];
          }
          return [];
        }

        const data = await response.json();

        if (data && data.models && Array.isArray(data.models)) {
          const models = data.models
            .filter(model => {
              return model.supportedGenerationMethods &&
                model.supportedGenerationMethods.includes('generateContent');
            })
            .map(model => {
              return model.name.replace('models/', '');
            })
            .sort();

          return models;
        }
        return [];
      } catch (error) {
        return [];
      }
    }

    async function testOpenAIKey(apiKey, model = null) {
      try {
        const selectedModel = model || getSelectedModel();
        if (!selectedModel) {
          return { valid: false, error: 'æœªæŒ‡å®šæ¨¡å‹', isRateLimit: false };
        }

        const apiUrl = getApiUrl('openai', '/chat/completions');
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + apiKey,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            model: selectedModel,
            messages: [{ role: 'user', content: 'Hi' }],
            max_tokens: 1
          })
        });

        if (!response.ok) {
          if (response.status === 401) return { valid: false, error: 'è®¤è¯å¤±è´¥ (401)', isRateLimit: false };
          if (response.status === 403) return { valid: false, error: 'æƒé™ä¸è¶³ (403)', isRateLimit: false };
          if (response.status === 429) return { valid: false, error: 'Rate Limited (429)', isRateLimit: true };
          return { valid: false, error: 'HTTP ' + response.status, isRateLimit: response.status === 429 };
        }

        const responseText = await response.text();
        if (!responseText || responseText.trim() === '') {
          return { valid: false, error: 'ç©ºå“åº”', isRateLimit: false };
        }

        let data;
        try {
          data = JSON.parse(responseText);
        } catch (parseError) {
          return { valid: false, error: 'JSONè§£æå¤±è´¥', isRateLimit: false };
        }

        if (data && data.error) {
          const errorMessage = data.error.message || data.error.toString();
          if (errorMessage.toLowerCase().includes('rate limit') ||
            errorMessage.toLowerCase().includes('too many requests') ||
            errorMessage.toLowerCase().includes('quota exceeded')) {
            return { valid: false, error: 'Rate Limited: ' + errorMessage, isRateLimit: true };
          }
        }

        if (data && data.choices && Array.isArray(data.choices)) {
          return { valid: true, error: null, isRateLimit: false };
        } else {
          return { valid: false, error: 'å“åº”æ ¼å¼é”™è¯¯', isRateLimit: false };
        }
      } catch (error) {
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          return { valid: false, error: 'ç½‘ç»œè¿æ¥å¤±è´¥', isRateLimit: false };
        }
        return { valid: false, error: 'è¯·æ±‚å¤±è´¥: ' + error.message, isRateLimit: false };
      }
    }

    async function testClaudeKey(apiKey, model = null) {
      try {
        const selectedModel = model || getSelectedModel();
        if (!selectedModel) {
          return { valid: false, error: 'æœªæŒ‡å®šæ¨¡å‹', isRateLimit: false };
        }

        const apiUrl = getApiUrl('claude', '/messages');
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'x-api-key': apiKey,
            'Content-Type': 'application/json',
            'anthropic-version': '2023-06-01'
          },
          body: JSON.stringify({
            model: selectedModel,
            max_tokens: 1,
            messages: [{ role: 'user', content: 'Hi' }]
          })
        });

        if (response.status === 401) return { valid: false, error: 'è®¤è¯å¤±è´¥ (401)', isRateLimit: false };
        if (response.status === 403) return { valid: false, error: 'æƒé™ä¸è¶³ (403)', isRateLimit: false };
        if (response.status === 429) return { valid: false, error: 'Rate Limited (429)', isRateLimit: true };

        const responseText = await response.text();

        if (response.status === 400) {
          try {
            const errorData = JSON.parse(responseText);
            if (errorData.error && errorData.error.type === 'authentication_error') {
              return { valid: false, error: 'è®¤è¯é”™è¯¯', isRateLimit: false };
            }
            if (errorData.error && errorData.error.type === 'rate_limit_error') {
              return { valid: false, error: 'Rate Limit Error', isRateLimit: true };
            }
            if (errorData.error && errorData.error.type === 'invalid_request_error') {
              return { valid: true, error: null, isRateLimit: false };
            }
            return { valid: false, error: 'APIé”™è¯¯: ' + (errorData.error.type || 'unknown'), isRateLimit: false };
          } catch {
            return { valid: false, error: 'JSONè§£æå¤±è´¥', isRateLimit: false };
          }
        }

        if (response.ok) {
          return { valid: true, error: null, isRateLimit: false };
        } else {
          return { valid: false, error: 'HTTP ' + response.status, isRateLimit: false };
        }
      } catch (error) {
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          return { valid: false, error: 'ç½‘ç»œè¿æ¥å¤±è´¥', isRateLimit: false };
        }
        return { valid: false, error: 'è¯·æ±‚å¤±è´¥: ' + error.message, isRateLimit: false };
      }
    }

    async function testGeminiKey(apiKey, model = null) {
      try {
        const selectedModel = model || getSelectedModel();
        if (!selectedModel) {
          return { valid: false, error: 'æœªæŒ‡å®šæ¨¡å‹', isRateLimit: false };
        }

        const apiUrl = getApiUrl('gemini', '/models/' + selectedModel + ':generateContent?key=' + apiKey);
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            contents: [
              {
                parts: [
                  {
                    text: "Hi"
                  }
                ]
              }
            ]
          })
        });

        if (!response.ok) {
          if (response.status === 400) return { valid: false, error: 'APIå¯†é’¥æ— æ•ˆ (400)', isRateLimit: false };
          if (response.status === 401) return { valid: false, error: 'è®¤è¯å¤±è´¥ (401)', isRateLimit: false };
          if (response.status === 403) return { valid: false, error: 'æƒé™ä¸è¶³ (403)', isRateLimit: false };
          if (response.status === 429) return { valid: false, error: 'Rate Limited (429)', isRateLimit: true };
          return { valid: false, error: 'HTTP ' + response.status, isRateLimit: response.status === 429 };
        }

        const responseText = await response.text();
        if (!responseText || responseText.trim() === '') {
          return { valid: false, error: 'ç©ºå“åº”', isRateLimit: false };
        }

        let data;
        try {
          data = JSON.parse(responseText);
        } catch (parseError) {
          return { valid: false, error: 'JSONè§£æå¤±è´¥', isRateLimit: false };
        }

        if (data && data.candidates && Array.isArray(data.candidates) && data.candidates.length > 0) {
          return { valid: true, error: null, isRateLimit: false };
        } else if (data && data.error) {
          const errorMessage = data.error.message || data.error.toString();
          if (errorMessage.toLowerCase().includes('quota exceeded') ||
            errorMessage.toLowerCase().includes('rate limit') ||
            errorMessage.toLowerCase().includes('too many requests')) {
            return { valid: false, error: 'Rate Limited: ' + errorMessage, isRateLimit: true };
          }
          return { valid: false, error: 'APIé”™è¯¯: ' + errorMessage, isRateLimit: false };
        } else {
          return { valid: false, error: 'å“åº”æ ¼å¼é”™è¯¯', isRateLimit: false };
        }
      } catch (error) {
        if (error.name === 'TypeError' && error.message.includes('fetch')) {
          return { valid: false, error: 'ç½‘ç»œè¿æ¥å¤±è´¥', isRateLimit: false };
        }
        if (error.name === 'SyntaxError' && error.message.includes('JSON')) {
          return { valid: false, error: 'JSONè§£æå¤±è´¥', isRateLimit: false };
        }
        return { valid: false, error: 'è¯·æ±‚å¤±è´¥: ' + error.message, isRateLimit: false };
      }
    }

    async function testApiKey(apiKey, apiType) {
      let result;
      switch (apiType) {
        case 'openai':
          result = await testOpenAIKey(apiKey);
          break;
        case 'claude':
          result = await testClaudeKey(apiKey);
          break;
        case 'gemini':
          result = await testGeminiKey(apiKey);
          break;
        default:
          result = { valid: false, error: 'ä¸æ”¯æŒçš„APIç±»å‹', isRateLimit: false };
      }

      // é€šç”¨çš„429é”™è¯¯æ£€æµ‹
      if (!result.valid && result.error && (result.error.includes('429') || result.error.includes('è¯·æ±‚è¿‡å¤š') || result.error.toLowerCase().includes('rate limit') || result.error.toLowerCase().includes('too many requests'))) {
        result.isRateLimit = true;
      }

      return result;
    }

    function getLocalizedError(errorKey) {
      if (errorKey && (errorKey.includes('429') || errorKey.includes('Rate Limited') || errorKey.toLowerCase().includes('rate limit'))) {
        if (currentLang === 'zh') {
          if (errorKey.includes('Rate Limited (429)')) {
            return 'é€Ÿç‡é™åˆ¶ (429)';
          } else if (errorKey.includes('Rate Limited')) {
            return 'é€Ÿç‡é™åˆ¶';
          } else if (errorKey.includes('429')) {
            return 'é€Ÿç‡é™åˆ¶ (429)';
          }
          return 'é€Ÿç‡é™åˆ¶';
        } else {
          return errorKey;
        }
      }

      const errorMap = {
        'è®¤è¯å¤±è´¥ (401)': currentLang === 'zh' ? 'è®¤è¯å¤±è´¥ (401)' : 'Auth Failed (401)',
        'æƒé™ä¸è¶³ (403)': currentLang === 'zh' ? 'æƒé™ä¸è¶³ (403)' : 'Permission Denied (403)',
        'è¯·æ±‚è¿‡å¤š (429)': currentLang === 'zh' ? 'è¯·æ±‚è¿‡å¤š (429)' : 'Too Many Requests (429)',
        'Rate Limited (429)': currentLang === 'zh' ? 'é€Ÿç‡é™åˆ¶ (429)' : 'Rate Limited (429)',
        'ç½‘ç»œè¿æ¥å¤±è´¥': currentLang === 'zh' ? 'ç½‘ç»œè¿æ¥å¤±è´¥' : 'Network Connection Failed',
        'JSONè§£æå¤±è´¥': currentLang === 'zh' ? 'JSONè§£æå¤±è´¥' : 'JSON Parse Failed',
        'ç©ºå“åº”': currentLang === 'zh' ? 'ç©ºå“åº”' : 'Empty Response',
        'å“åº”æ ¼å¼é”™è¯¯': currentLang === 'zh' ? 'å“åº”æ ¼å¼é”™è¯¯' : 'Invalid Response Format',
        'è®¤è¯é”™è¯¯': currentLang === 'zh' ? 'è®¤è¯é”™è¯¯' : 'Authentication Error',
        'æœªæŒ‡å®šæ¨¡å‹': currentLang === 'zh' ? 'æœªæŒ‡å®šæ¨¡å‹' : 'No Model Specified',
        'APIå¯†é’¥æ— æ•ˆ (400)': currentLang === 'zh' ? 'APIå¯†é’¥æ— æ•ˆ (400)' : 'Invalid API Key (400)',
        'æµ‹è¯•å¼‚å¸¸': currentLang === 'zh' ? 'æµ‹è¯•å¼‚å¸¸' : 'Test Exception',
        'é‡è¯•å¤±è´¥': currentLang === 'zh' ? 'é‡è¯•å¤±è´¥' : 'Retry Failed',
        'ä¸æ”¯æŒçš„APIç±»å‹': currentLang === 'zh' ? 'ä¸æ”¯æŒçš„APIç±»å‹' : 'Unsupported API Type'
      };

      if (errorMap[errorKey]) {
        return errorMap[errorKey];
      }

      if (errorKey && errorKey.startsWith('APIé”™è¯¯:')) {
        const detail = errorKey.replace('APIé”™è¯¯:', '').trim();
        return currentLang === 'zh' ? 'APIé”™è¯¯: ' + detail : 'API Error: ' + detail;
      }

      if (errorKey && errorKey.startsWith('è¯·æ±‚å¤±è´¥:')) {
        const detail = errorKey.replace('è¯·æ±‚å¤±è´¥:', '').trim();
        return currentLang === 'zh' ? 'è¯·æ±‚å¤±è´¥: ' + detail : 'Request Failed: ' + detail;
      }

      if (errorKey && errorKey.startsWith('æµ‹è¯•å¼‚å¸¸:')) {
        const detail = errorKey.replace('æµ‹è¯•å¼‚å¸¸:', '').trim();
        return currentLang === 'zh' ? 'æµ‹è¯•å¼‚å¸¸: ' + detail : 'Test Exception: ' + detail;
      }

      if (errorKey && errorKey.startsWith('Rate Limited:')) {
        if (currentLang === 'zh') {
          const detail = errorKey.replace('Rate Limited:', '').trim();
          return 'é€Ÿç‡é™åˆ¶: ' + detail;
        } else {
          return errorKey;
        }
      }

      if (errorKey && errorKey.includes('HTTP ')) {
        return errorKey;
      }

      if (errorKey && errorKey.includes('(') && errorKey.includes(')')) {
        const match = errorKey.match(/^(.+?)\s*\((\d{3})\)$/);
        if (match) {
          const errorText = match[1];
          const statusCode = match[2];

          const errorTextMap = {
            'APIå¯†é’¥æ— æ•ˆ': currentLang === 'zh' ? 'APIå¯†é’¥æ— æ•ˆ' : 'Invalid API Key',
            'è®¤è¯å¤±è´¥': currentLang === 'zh' ? 'è®¤è¯å¤±è´¥' : 'Auth Failed',
            'æƒé™ä¸è¶³': currentLang === 'zh' ? 'æƒé™ä¸è¶³' : 'Permission Denied',
            'è¯·æ±‚è¿‡å¤š': currentLang === 'zh' ? 'è¯·æ±‚è¿‡å¤š' : 'Too Many Requests'
          };

          const translatedText = errorTextMap[errorText] || errorText;
          return `${translatedText} (${statusCode})`;
        }
      }

      return errorKey || (currentLang === 'zh' ? 'æœªçŸ¥é”™è¯¯' : 'Unknown Error');
    }

    function deduplicateAndCleanKeys(keys) {
      const seen = new Set();
      const uniqueKeys = [];
      const duplicates = [];

      keys.forEach(key => {
        const cleanKey = key.trim();
        if (cleanKey && !seen.has(cleanKey)) {
          seen.add(cleanKey);
          uniqueKeys.push(cleanKey);
        } else if (cleanKey && seen.has(cleanKey)) {
          duplicates.push(cleanKey);
        }
      });

      return { uniqueKeys, duplicates };
    }

    function updateStats() {
      const validKeys = allKeysData.filter(k => k.status === 'valid');
      const invalidKeys = allKeysData.filter(k => k.status === 'invalid');
      const rateLimitedKeys = allKeysData.filter(k => k.status === 'rate-limited');
      const testingKeys = allKeysData.filter(k => k.status === 'testing');
      const retryingKeys = allKeysData.filter(k => k.status === 'retrying');
      const pendingKeys = allKeysData.filter(k => k.status === 'pending');

      document.getElementById('totalCount').textContent = allKeysData.length;
      document.getElementById('validCount').textContent = validKeys.length;
      document.getElementById('invalidCount').textContent = invalidKeys.length;
      document.getElementById('rateLimitedCount').textContent = rateLimitedKeys.length;
      document.getElementById('testingCount').textContent = testingKeys.length + pendingKeys.length;
      document.getElementById('retryingCount').textContent = retryingKeys.length;
    }

    function updateKeyLists() {
      const validKeys = allKeysData.filter(k => k.status === 'valid');
      const invalidKeys = allKeysData.filter(k => k.status === 'invalid');
      const rateLimitedKeys = allKeysData.filter(k => k.status === 'rate-limited');

      updateKeyList('allKeys', allKeysData);
      updateKeyList('validKeys', validKeys);
      updateKeyList('invalidKeys', invalidKeys);
      updateKeyList('rateLimitedKeys', rateLimitedKeys);
    }

    function updateKeyList(elementId, keys) {
      const container = document.getElementById(elementId);
      if (!container) {
        return;
      }

      container.innerHTML = '';

      if (keys.length === 0) {
        const emptyState = document.createElement('div');
        emptyState.className = 'empty-state';

        let emptyMessage = '';
        switch (elementId) {
          case 'allKeys':
            emptyMessage = currentLang === 'zh' ? 'æš‚æ— å¯†é’¥' : 'No keys';
            break;
          case 'validKeys':
            emptyMessage = currentLang === 'zh' ? 'æš‚æ— æœ‰æ•ˆå¯†é’¥' : 'No valid keys';
            break;
          case 'invalidKeys':
            emptyMessage = currentLang === 'zh' ? 'æš‚æ— æ— æ•ˆå¯†é’¥' : 'No invalid keys';
            break;
          case 'rateLimitedKeys':
            emptyMessage = currentLang === 'zh' ? 'æš‚æ— é€Ÿç‡é™åˆ¶å¯†é’¥' : 'No rate limited keys';
            break;
          default:
            emptyMessage = currentLang === 'zh' ? 'æš‚æ— æ•°æ®' : 'No data';
        }

        emptyState.innerHTML = `
                    <div class="empty-icon">ğŸ“­</div>
                    <div class="empty-text">${emptyMessage}</div>
                `;

        container.appendChild(emptyState);
        return;
      }

      keys.forEach(keyData => {
        const keyItem = document.createElement('div');
        keyItem.className = 'key-item';

        const statusClass = keyData.status === 'valid' ? 'status-valid' :
          keyData.status === 'invalid' ? 'status-invalid' :
            keyData.status === 'rate-limited' ? 'status-rate-limited' :
              keyData.status === 'retrying' ? 'status-retrying' : 'status-testing';

        const statusText = translations[currentLang]['status-' + keyData.status] || keyData.status;

        let errorDisplay = '';
        if ((keyData.status === 'invalid' || keyData.status === 'rate-limited') && keyData.error) {
          const localizedError = getLocalizedError(keyData.error);
          const errorColor = keyData.status === 'rate-limited' ? '#856404' : '#dc3545';
          errorDisplay = '<div style="font-size: 11px; color: ' + errorColor + '; margin-top: 2px;">' + localizedError + '</div>';
        }

        let modelDisplay = '';
        if (keyData.model) {
          modelDisplay = '<div style="font-size: 11px; color: #6c757d; margin-top: 2px;">Model: ' + keyData.model + '</div>';
        }

        let retryDisplay = '';
        if (keyData.retryCount && keyData.retryCount > 0) {
          const retryText = currentLang === 'zh' ? 'é‡è¯•' : 'Retry';
          retryDisplay = '<div style="font-size: 11px; color: #f39c12; margin-top: 2px;">' + retryText + ': ' + keyData.retryCount + '</div>';
        }

        keyItem.innerHTML = '<div class="key-text">' + keyData.key + modelDisplay + errorDisplay + retryDisplay + '</div><div class="key-status ' + statusClass + '">' + statusText + '</div>';

        container.appendChild(keyItem);
      });
    }

    function showTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

      const tabButton = document.querySelector(`[data-tab="${tab}"]`);
      let tabContentId = tab + 'Tab';
      if (tab === 'rate-limited') {
        tabContentId = 'rateLimitedTab';
      }
      const tabContent = document.getElementById(tabContentId);

      if (tabButton) {
        tabButton.classList.add('active');
      }
      if (tabContent) {
        tabContent.classList.add('active');
      }
    }

    function copyKeys(type) {
      let keysToCopy = [];

      switch (type) {
        case 'all':
          keysToCopy = allKeysData.map(k => k.key);
          break;
        case 'valid':
          keysToCopy = allKeysData.filter(k => k.status === 'valid').map(k => k.key);
          break;
        case 'invalid':
          keysToCopy = allKeysData.filter(k => k.status === 'invalid').map(k => k.key);
          break;
        case 'rate-limited':
          keysToCopy = allKeysData.filter(k => k.status === 'rate-limited').map(k => k.key);
          break;
      }

      if (keysToCopy.length === 0) {
        const message = currentLang === 'zh' ? 'æ²¡æœ‰å¯å¤åˆ¶çš„å¯†é’¥ï¼' : 'No keys to copy!';
        alert(message);
        return;
      }

      navigator.clipboard.writeText(keysToCopy.join('\n')).then(() => {
        const message = currentLang === 'zh' ?
          'å·²å¤åˆ¶ ' + keysToCopy.length + ' ä¸ªå¯†é’¥åˆ°å‰ªè´´æ¿ï¼' :
          'Copied ' + keysToCopy.length + ' keys to clipboard!';
        alert(message);
      }).catch(err => {
        // å¤åˆ¶å¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
        const textArea = document.createElement('textarea');
        textArea.value = keysToCopy.join('\n');
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        const message = currentLang === 'zh' ?
          'å·²å¤åˆ¶ ' + keysToCopy.length + ' ä¸ªå¯†é’¥åˆ°å‰ªè´´æ¿ï¼' :
          'Copied ' + keysToCopy.length + ' keys to clipboard!';
        alert(message);
      });
    }

    function deduplicateKeys() {
      const apiKeysText = document.getElementById('apiKeys').value.trim();

      if (!apiKeysText) {
        alert(currentLang === 'zh' ? 'è¯·å…ˆè¾“å…¥APIå¯†é’¥ï¼' : 'Please enter API keys first!');
        return;
      }

      const rawKeys = apiKeysText.split('\n').filter(key => key.trim());
      const { uniqueKeys, duplicates } = deduplicateAndCleanKeys(rawKeys);

      if (duplicates.length > 0) {
        document.getElementById('apiKeys').value = uniqueKeys.join('\n');

        const message = currentLang === 'zh' ?
          `å·²å»é™¤ ${duplicates.length} ä¸ªé‡å¤å¯†é’¥ï¼Œä¿ç•™ ${uniqueKeys.length} ä¸ªå”¯ä¸€å¯†é’¥ã€‚` :
          `Removed ${duplicates.length} duplicate keys, kept ${uniqueKeys.length} unique keys.`;
        alert(message);
      } else {
        const message = currentLang === 'zh' ?
          'æœªå‘ç°é‡å¤å¯†é’¥ã€‚' :
          'No duplicate keys found.';
        alert(message);
      }
    }

    function clearAll() {
      if (isTestingInProgress) {
        const message = currentLang === 'zh' ? 'æµ‹è¯•æ­£åœ¨è¿›è¡Œä¸­ï¼Œæ— æ³•æ¸…ç©ºï¼' : 'Testing in progress, cannot clear!';
        alert(message);
        return;
      }

      document.getElementById('apiKeys').value = '';
      document.getElementById('modelInput').value = '';
      document.getElementById('resultsSection').classList.add('hidden');
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('progressBar').classList.add('hidden');
      document.getElementById('progressFill').style.width = '0%';
      document.getElementById('detectedModels').style.display = 'none';

      allKeysData = [];
      detectedModels.clear();
      completedCount = 0;
      totalCount = 0;

      updateStats();
      updateKeyLists();

      showTab('all');
    }

    // ç²˜è´´åŠŸèƒ½
    async function pasteFromClipboard() {
      try {
        const text = await navigator.clipboard.readText();
        const apiKeysTextarea = document.getElementById('apiKeys');
        const currentValue = apiKeysTextarea.value;

        // å¦‚æœå½“å‰æœ‰å†…å®¹ï¼Œæ·»åŠ æ¢è¡Œç¬¦
        if (currentValue.trim()) {
          apiKeysTextarea.value = currentValue + '\n' + text;
        } else {
          apiKeysTextarea.value = text;
        }

        // è§¦å‘äº‹ä»¶ï¼Œè®©å…¶ä»–ç›‘å¬å™¨çŸ¥é“å†…å®¹å·²æ”¹å˜
        apiKeysTextarea.dispatchEvent(new Event('input'));
      } catch (err) {
        alert(currentLang === 'zh' ? 'æ— æ³•è¯»å–å‰ªè´´æ¿å†…å®¹ï¼Œè¯·ç¡®ä¿å·²æˆæƒè®¿é—®å‰ªè´´æ¿' : 'Cannot read clipboard content, please ensure clipboard access is authorized');
      }
    }

    // å¯¼å…¥æ–‡ä»¶åŠŸèƒ½
    function importFile() {
      document.getElementById('fileInput').click();
    }

    // å¤„ç†æ–‡ä»¶é€‰æ‹©
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;

      // æ£€æŸ¥æ–‡ä»¶æ‰©å±•åå’Œç±»å‹
      const fileName = file.name.toLowerCase();
      const isTextFile = fileName.endsWith('.txt') || file.type === 'text/plain' || file.type === '';

      if (!isTextFile) {
        alert(currentLang === 'zh' ? 'è¯·é€‰æ‹©ä¸€ä¸ª.txtæ–‡ä»¶' : 'Please select a .txt file');
        event.target.value = '';
        return;
      }

      // æ£€æŸ¥æ–‡ä»¶å¤§å° (é™åˆ¶ä¸º10MB)
      const maxSize = 10 * 1024 * 1024; // 10MB
      if (file.size > maxSize) {
        alert(currentLang === 'zh' ? 'æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº10MBçš„æ–‡ä»¶' : 'File too large, please select a file smaller than 10MB');
        event.target.value = '';
        return;
      }

      // æ˜¾ç¤ºloadingçŠ¶æ€
      const importBtn = document.getElementById('importBtn');
      const originalText = importBtn.textContent;
      importBtn.textContent = currentLang === 'zh' ? 'å¯¼å…¥ä¸­...' : 'Importing...';
      importBtn.disabled = true;

      const reader = new FileReader();

      reader.onload = function (e) {
        try {
          const content = e.target.result;
          const extractedKeys = extractApiKeys(content);

          if (extractedKeys.length > 0) {
            const apiKeysTextarea = document.getElementById('apiKeys');
            const currentValue = apiKeysTextarea.value;

            // å¦‚æœå½“å‰æœ‰å†…å®¹ï¼Œæ·»åŠ æ¢è¡Œç¬¦
            if (currentValue.trim()) {
              apiKeysTextarea.value = currentValue + '\n' + extractedKeys.join('\n');
            } else {
              apiKeysTextarea.value = extractedKeys.join('\n');
            }

            // è§¦å‘äº‹ä»¶ï¼Œè®©å…¶ä»–ç›‘å¬å™¨çŸ¥é“å†…å®¹å·²æ”¹å˜
            apiKeysTextarea.dispatchEvent(new Event('input'));

            const message = currentLang === 'zh' ?
              `æˆåŠŸå¯¼å…¥ ${extractedKeys.length} ä¸ªAPIå¯†é’¥` :
              `Successfully imported ${extractedKeys.length} API keys`;
            alert(message);
          } else {
            alert(currentLang === 'zh' ? 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„APIå¯†é’¥' : 'No valid API keys found');
          }
        } catch (error) {
          alert(currentLang === 'zh' ? 'æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼' : 'File reading failed, please check file format');
        } finally {
          // æ¢å¤æŒ‰é’®çŠ¶æ€
          importBtn.textContent = originalText;
          importBtn.disabled = false;
        }
      };

      reader.onerror = function () {
        alert(currentLang === 'zh' ? 'æ–‡ä»¶è¯»å–å¤±è´¥' : 'File reading failed');
        importBtn.textContent = originalText;
        importBtn.disabled = false;
      };

      reader.readAsText(file, 'UTF-8');

      // æ¸…ç©ºfile inputä»¥ä¾¿é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
      event.target.value = '';
    }

    // æå–APIå¯†é’¥
    function extractApiKeys(content) {
      const keys = [];

      // ç›´æ¥ä»åŸå§‹å†…å®¹ä¸­æå–APIå¯†é’¥ï¼Œä¸è¦é¢„å…ˆæ¸…ç†
      const extractedKeys = extractKeysFromContent(content);

      // å¯¹æ¯ä¸ªæå–çš„å¯†é’¥è¿›è¡Œæ¸…ç†å’ŒéªŒè¯
      for (let key of extractedKeys) {
        const cleanedKey = cleanApiKey(key);
        if (cleanedKey && cleanedKey.length >= 15) {
          keys.push(cleanedKey);
        }
      }

      // å»é‡å¹¶è¿”å›
      const uniqueKeys = [...new Set(keys)];

      // æŒ‰é•¿åº¦æ’åºï¼Œé•¿çš„å¯†é’¥ä¼˜å…ˆ (é€šå¸¸æ›´å¯èƒ½æ˜¯æœ‰æ•ˆçš„)
      return uniqueKeys.sort((a, b) => b.length - a.length);
    }

    // ä»å†…å®¹ä¸­æå–APIå¯†é’¥
    function extractKeysFromContent(content) {
      const keys = [];

      // OpenAI/Claude APIå¯†é’¥æ¨¡å¼: sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
      // å…è®¸ä¸­é—´æœ‰ä»»æ„å­—ç¬¦ï¼ŒåŒ…æ‹¬Claudeçš„sk-ant-sid01-æ ¼å¼
      const openaiPattern = /sk-[a-zA-Z0-9\u4e00-\u9fff\-_]{30,}/g;

      // Gemini APIå¯†é’¥æ¨¡å¼: AIzaSyxxxxxxxxxxxxxxxxxxxxxxx
      // å…è®¸ä¸­é—´æœ‰ä»»æ„å­—ç¬¦
      const geminiPattern = /AIzaSy[a-zA-Z0-9\u4e00-\u9fff_\-]{30,}/g;

      // Cohere APIå¯†é’¥æ¨¡å¼
      const coherePattern = /[a-zA-Z0-9\u4e00-\u9fff\-_]{40,}/g;

      // Anthropic APIå¯†é’¥æ¨¡å¼ (é™¤äº†sk-ant-sid01-ä¹‹å¤–çš„æ ¼å¼)
      const anthropicPattern = /[a-zA-Z0-9\u4e00-\u9fff\-_]{32,}/g;

      // é€šç”¨APIå¯†é’¥æ¨¡å¼
      const genericPattern = /(?:sk-|gsk_|api_|key_|token_|pk-)[a-zA-Z0-9\u4e00-\u9fff\-_]{20,}/g;

      let matches;

      // æ£€æŸ¥OpenAI/Claudeå¯†é’¥ (sk-å¼€å¤´) - ä¼˜å…ˆçº§æœ€é«˜
      matches = content.match(openaiPattern);
      if (matches) {
        keys.push(...matches);
      }

      // æ£€æŸ¥Geminiå¯†é’¥
      matches = content.match(geminiPattern);
      if (matches) {
        keys.push(...matches);
      }

      // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç‰¹å®šæ ¼å¼çš„å¯†é’¥ï¼Œå°è¯•é€šç”¨æ¨¡å¼
      if (keys.length === 0) {
        matches = content.match(genericPattern);
        if (matches) {
          keys.push(...matches);
        }
      }

      // æœ€åå°è¯•åŒ¹é…é•¿å­—ç¬¦ä¸² (å…œåº•æ–¹æ¡ˆ)
      if (keys.length === 0) {
        const longStringPattern = /[a-zA-Z0-9\u4e00-\u9fff\-_]{25,}/g;
        matches = content.match(longStringPattern);
        if (matches) {
          // è¿‡æ»¤æ‰å¯èƒ½çš„è¯¯åŒ¹é…
          const filteredMatches = matches.filter(match => {
            // æ’é™¤çº¯æ•°å­—æˆ–çº¯å­—æ¯çš„å­—ç¬¦ä¸²
            return !/^[0-9]+$/.test(match.replace(/[\u4e00-\u9fff]/g, '')) &&
              !/^[a-zA-Z]+$/.test(match.replace(/[\u4e00-\u9fff]/g, ''));
          });
          keys.push(...filteredMatches);
        }
      }

      return keys;
    }

    // æ¸…ç†å•ä¸ªAPIå¯†é’¥ä¸­çš„å¹²æ‰°å­—ç¬¦
    function cleanApiKey(key) {
      // ç§»é™¤ä¸­æ–‡å­—ç¬¦å’Œç‰¹æ®Šç¬¦å·ï¼Œåªä¿ç•™è‹±æ–‡å­—æ¯ã€æ•°å­—ã€çŸ­æ¨ªçº¿ã€ä¸‹åˆ’çº¿
      let cleaned = key.replace(/[^\w\-]/g, '');

      // è¿›ä¸€æ­¥éªŒè¯æ¸…ç†åçš„å¯†é’¥
      if (cleaned.length < 15) {
        return null; // å¤ªçŸ­çš„å¯†é’¥å¯èƒ½ä¸æ˜¯æœ‰æ•ˆçš„APIå¯†é’¥
      }

      // æ£€æŸ¥æ˜¯å¦åŒ…å«è¶³å¤Ÿçš„å­—æ¯æ•°å­—ç»„åˆ
      const hasLetters = /[a-zA-Z]/.test(cleaned);
      const hasNumbers = /[0-9]/.test(cleaned);

      if (!hasLetters || !hasNumbers) {
        return null; // APIå¯†é’¥é€šå¸¸åŒ…å«å­—æ¯å’Œæ•°å­—
      }

      return cleaned;
    }

    function initializeEventListeners() {
      document.getElementById('langBtn').addEventListener('click', toggleLanguage);
      document.getElementById('themeBtn').addEventListener('click', toggleTheme);
      document.getElementById('apiType').addEventListener('change', updateProxyPlaceholder);
      document.getElementById('modelToggleBtn').addEventListener('click', toggleModelInput);
      document.getElementById('detectedModelsHeader').addEventListener('click', toggleModelList);
      document.getElementById('detectBtn').addEventListener('click', detectModels);
      document.getElementById('startBtn').addEventListener('click', startTesting);
      document.getElementById('dedupeBtn').addEventListener('click', deduplicateKeys);
      document.getElementById('clearBtn').addEventListener('click', clearAll);
      document.getElementById('pasteBtn').addEventListener('click', pasteFromClipboard);
      document.getElementById('importBtn').addEventListener('click', importFile);
      document.getElementById('fileInput').addEventListener('change', handleFileSelect);

      document.querySelectorAll('[data-tab]').forEach(tab => {
        tab.addEventListener('click', (e) => {
          showTab(e.target.getAttribute('data-tab'));
        });
      });

      document.querySelectorAll('[data-copy]').forEach(btn => {
        btn.addEventListener('click', (e) => {
          copyKeys(e.target.getAttribute('data-copy'));
        });
      });
    }

    function handleResize() {
      if (window.innerWidth <= 768) {
        const keyLists = document.querySelectorAll('.key-list');
        keyLists.forEach(list => {
          const maxHeight = Math.min(300, window.innerHeight * 0.4);
          list.style.maxHeight = maxHeight + 'px';
        });
      }
    }

    function initialize() {
      updateProxyPlaceholder();
      updateLanguage();
      initializeEventListeners();
      initConcurrencyControls();
      initRetryControls();

      window.addEventListener('resize', handleResize);
      window.addEventListener('orientationchange', () => {
        setTimeout(handleResize, 100);
      });

      handleResize();
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initialize);
    } else {
      initialize();
    }
  </script>
</body>

</html>